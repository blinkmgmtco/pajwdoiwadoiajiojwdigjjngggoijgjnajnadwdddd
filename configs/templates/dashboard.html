<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitter Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
<style>
        :root {
            /* Updated color scheme to match login page */
            --primary-color: #6366f1;
            --primary-dark: #5b21b6;
            --primary-light: #8b5cf6;
            --secondary-color: #ffffff;
            --accent-color: #a855f7;
            --background: #09090b;
            --background-alt: #18181b;
            --surface: rgba(39, 39, 42, 0.95);
            --surface-alt: rgba(63, 63, 70, 0.8);
            --surface-lighter: rgba(82, 82, 91, 0.6);
            --border: rgba(63, 63, 70, 0.4);
            --border-light: rgba(82, 82, 91, 0.3);
            --text-primary: #ffffff;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #dc2626;
            --info: var(--primary-color);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.6);
            --shadow-glow: 0 0 40px rgba(99, 102, 241, 0.15);
            --radius-sm: 0.5rem;
            --radius: 0.75rem;
            --radius-md: 1rem;
            --radius-lg: 1.25rem;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --border-radius: 16px;
        }

        .sidebar .nav-link {
    outline: none !important;
}

.sidebar .nav-link:focus {
    outline: none !important;
    box-shadow: none !important;
}

/* Remove the focus ring for Bootstrap 5 */
.sidebar .nav-link:focus-visible {
    outline: none !important;
    box-shadow: none !important;
}

/* For browsers that don't support focus-visible */
.sidebar .nav-link:focus:not(:focus-visible) {
    outline: none !important;
    box-shadow: none !important;
}

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, var(--background) 0%, var(--background-alt) 30%, #27272a 100%);
            background-attachment: fixed;
            color: var(--text-primary);
            line-height: 1.6;
            font-weight: 400;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(168, 85, 247, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.03) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container-fluid {
            padding-left: 0;
            padding-right: 0;
        }

        /* Layout */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 240px;
            height: 100vh;
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
            overflow-y: auto;
            transition: var(--transition);
            z-index: 1000;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .sidebar::-webkit-scrollbar {
            display: none;
        }

        .main-content {
            margin-left: 240px;
            padding: 1.5rem;
            width: calc(100% - 240px);
            min-height: 100vh;
            background: transparent;
        }

        /* Header Section */
        .header-section {
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-md);
            margin-bottom: 1.5rem;
            backdrop-filter: blur(20px);
        }

        .header-section h3 {
            color: var(--text-primary);
            font-weight: 700;
            font-size: 1.5rem;
            margin: 0 0 0.5rem 0;
            letter-spacing: -0.02em;
        }

        .header-section .text-muted {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin: 0;
            opacity: 0.9;
        }

        .header-section .badge {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            border: none;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        /* Navigation */
        .logo {
            display: flex;
            align-items: center;
            padding: 1.5rem 1rem;
            border-bottom: 1px solid var(--border);
            margin-bottom: 1rem;
            position: relative;
        }

        /* Add this line to remove the blue gradient line */
.logo::before {
    display: none;
}
        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            margin-right: 0.75rem;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .logo-text {
            color: white;
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .sidebar .nav-link {
            color: var(--text-secondary);
            padding: 0.875rem 1rem;
            margin: 0.125rem 0.5rem;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            text-decoration: none;
            border: none;
            background: none;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .sidebar .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .sidebar .nav-link:hover {
            color: var(--primary-color);
            background: rgba(99, 102, 241, 0.1);
            transform: translateX(4px);
        }

        .sidebar .nav-link:hover::before {
            left: 100%;
        }

        .sidebar .nav-link.active {
            color: var(--primary-color);
            background: rgba(99, 102, 241, 0.15);
            font-weight: 600;
            border-left: 3px solid var(--primary-color);
        }

        .sidebar .nav-link i {
            width: 20px;
            height: 20px;
            margin-right: 0.75rem;
            font-size: 1rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--border), transparent);
            margin: 0.75rem 0;
        }

        /* Logout Button */
        .logout-btn {
            margin: 1rem 0.5rem 0;
            padding: 0.75rem 1rem;
            background: rgba(220, 38, 38, 0.1);
            color: var(--danger);
            border: 1px solid rgba(220, 38, 38, 0.2);
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            text-decoration: none;
            cursor: pointer;
            width: calc(100% - 1rem);
            position: relative;
            overflow: hidden;
        }

        .logout-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(220, 38, 38, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .logout-btn:hover {
            background: rgba(220, 38, 38, 0.2);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }

        .logout-btn:hover::before {
            left: 100%;
        }

        .logout-btn i {
            margin-right: 0.75rem;
        }

        /* Module System */
        .module-container {
            display: none;
            animation: fadeInUp 0.4s ease-out;
        }

        .module-container.active {
            display: block;
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        /* Cards & Containers */
        .form-container {
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            margin-bottom: 1.5rem;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-md);
            backdrop-filter: blur(20px);
            transition: var(--transition);
        }

        .form-container:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .table-container {
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            overflow: hidden;
            margin-top: 1.25rem;
            box-shadow: var(--shadow-md);
            padding: 1.25rem;
            backdrop-filter: blur(20px);
        }

        .summary-card {
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            overflow: hidden;
            backdrop-filter: blur(20px);
            position: relative;
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            opacity: 0;
            transition: var(--transition);
        }

        .summary-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg), var(--shadow-glow);
            border-color: var(--primary-color);
        }

        .summary-card:hover::before {
            opacity: 1;
        }

        .card-title {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin: 0 0 0.5rem 0;
        }

        .card-text {
            color: var(--text-primary);
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header {
            border-radius: var(--radius-lg);
            padding: 1rem 1.25rem;
            margin-bottom: 1.25rem;
            box-shadow: var(--shadow-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border);
            backdrop-filter: blur(20px);
        }

        .header h2 {
            margin: 0;
            color: var(--text-primary);
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        /* Forms */
        .form-label {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .form-control {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            background: var(--surface-alt);
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
            color:white;
        }

        .form-control::placeholder {
            color: var(--text-muted);
            opacity: 0.7;
        }

        .bulk-textarea {
            min-height: 150px;
            font-family: 'JetBrains Mono', 'SF Mono', Consolas, monospace;
            font-size: 0.8125rem;
            resize: vertical;
            background: var(--surface-alt);
            color: var(--text-primary);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-twitter,
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .btn-twitter:hover,
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--accent-color) 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
            color: white;
        }

        .btn-outline-twitter,
        .btn-outline-primary {
            background: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-outline-twitter:hover,
        .btn-outline-primary:hover {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            color: white;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--surface-alt);
            color: var(--text-secondary);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--surface-lighter);
            color: var(--text-primary);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8125rem;
        }

        .btn-xs {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
        }

        /* Tables */
.table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.875rem;
    color: var(--text-primary) !important; /* Force text color */
}

.table th {
    background: var(--surface-alt);
    color: var(--text-primary);
    font-weight: 600;
    padding: 1rem;
    text-align: left;
    border-bottom: 2px solid var(--border);
    border-top: none;
    font-size: 0.8125rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.table td {
    padding: 1rem;
    border-bottom: 1px solid var(--border-light);
    color: var(--text-primary) !important; /* Force text color */
}

.table-striped tbody tr:nth-of-type(odd) {
    background: rgba(82, 82, 91, 0.1);
}

.table-hover tbody tr:hover {
    background: rgba(99, 102, 241, 0.1);
    transform: scale(1.01);
    transition: var(--transition);
}

.table-responsive {
    border-radius: var(--radius-lg);
    overflow: hidden;
}
        .command-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        .command-table th {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            color: white;
            padding: 0.75rem 1rem;
            font-weight: 600;
            text-align: left;
        }

        .command-table td {
            padding: 0.625rem 1rem;
            border-bottom: 1px solid var(--border-light);
        }

        .command-table tr:nth-child(even) {
            background: var(--surface-alt);
        }

        .command-table tr:hover {
            background: rgba(99, 102, 241, 0.1);
            transform: scale(1.01);
            transition: var(--transition);
        }

        .command-name {
            font-family: 'JetBrains Mono', 'SF Mono', Consolas, monospace;
            font-weight: 700;
            color: var(--primary-color);
            font-size: 0.8125rem;
        }

        .command-args {
            font-family: 'JetBrains Mono', 'SF Mono', Consolas, monospace;
            color: var(--text-secondary);
            font-size: 0.8125rem;
        }

        /* Badges */
        .badge {
            padding: 0.375rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .badge-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            color: white;
        }

        .badge-success {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
        }

        .badge-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            color: white;
        }

        .badge-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #f59e0b 100%);
            color: white;
        }

        .badge-info {
            background: linear-gradient(135deg, var(--info) 0%, var(--primary-light) 100%);
            color: white;
        }

        .group-count-cell {
            text-align: center;
            font-weight: 600;
        }

        .group-count-badge {
            font-size: 0.9em;
            min-width: 30px;
            height: 1.5rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            color: white;
            border-radius: 10px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
        }

        /* Lists */
        .list-item {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 0.75rem 1rem;
            margin-bottom: 0.625rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .list-item:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
            border-color: var(--primary-color);
        }

        .list-item.selected {
            background: rgba(99, 102, 241, 0.15);
            border-color: var(--primary-color);
            border-left: 3px solid var(--primary-color);
            box-shadow: var(--shadow-glow);
        }

        .list-item-text {
            font-family: 'JetBrains Mono', 'SF Mono', Consolas, monospace;
            font-size: 0.8125rem;
            word-break: break-all;
            color: var(--text-primary);
        }

        .list-item-checkbox {
            margin-right: 0.625rem;
            accent-color: var(--primary-color);
            transform: scale(1.2);
        }

        /* Toggle Forms */
        .toggle-forms {
            display: flex;
            margin-bottom: 1.25rem;
            border-bottom: 1px solid var(--border);
        }

        .toggle-forms .btn {
            border-radius: 0;
            border: none;
            border-bottom: 3px solid transparent;
            margin-right: 0.3125rem;
            font-weight: 500;
            background: transparent;
            color: var(--text-secondary);
            padding: 0.75rem 1rem;
            transition: var(--transition);
        }

        .toggle-forms .btn:hover {
            color: var(--primary-color);
            background: rgba(99, 102, 241, 0.1);
        }

        .toggle-forms .btn.active {
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
            background: rgba(99, 102, 241, 0.1);
            font-weight: 600;
        }

        .toggle-forms .btn:first-child {
            border-top-left-radius: var(--radius-sm);
        }

        .toggle-forms .btn:last-child {
            border-top-right-radius: var(--radius-sm);
        }

        /* Batch Controls */
        .batch-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.9375rem;
            padding: 1rem;
            background: var(--surface-alt);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
        }

        .batch-selection-info {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .batch-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        @media (max-width: 767.98px) {
            .batch-actions {
                justify-content: center;
                gap: 0.5rem;
            }
        }

        .toggle-batch-buttons {
            display: flex;
            gap: 0.3125rem;
            margin-bottom: 0.625rem;
        }

        .toggle-batch-buttons .btn {
            margin-right: 0.3125rem;
        }

        .action-buttons {
            display: flex;
            gap: 0.3125rem;
        }

        .action-buttons .btn {
            margin-right: 0.3125rem;
            padding: 0.3125rem 0.625rem;
            font-size: 0.85rem;
        }

        /* Empty States */
        .empty-state,
        .no-items {
            text-align: center;
            padding: 3rem 1.25rem;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            margin-top: 1.25rem;
            backdrop-filter: blur(20px);
        }

        .empty-state i {
            font-size: 4rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
            opacity: 0.6;
        }

        .empty-state h4 {
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 0.625rem;
        }

        .empty-state p {
            color: var(--text-muted);
            margin-bottom: 1.5rem;
        }

        /* Modals */
        .modal-content {
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(20px);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            color: white;
            border-bottom: none;
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }

        .modal-title {
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .modal-body {
            background: var(--surface);
            color: var(--text-primary);
        }

        .modal-footer {
            background: var(--surface-alt);
            border-top: 1px solid var(--border);
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
        }

        /* Alerts */
        .alert-module {
            border: 1px solid var(--border);
            border-left: 4px solid var(--info);
            border-radius: var(--radius-sm);
            background: var(--surface);
            backdrop-filter: blur(10px);
        }

        /* Help Section */
        .help-section {
            max-width: 56.25rem;
            margin: 0 auto;
        }

        .help-description {
            background: var(--surface);
            padding: 1.25rem;
            border-radius: var(--radius);
            margin-bottom: 1.25rem;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-md);
            backdrop-filter: blur(20px);
        }

        /* Input Groups */
        .input-group-append {
            margin-left: -1px;
        }

        /* Utilities */
        .spinner-border {
            width: 1rem;
            height: 1rem;
            border: 2px solid var(--border);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            vertical-align: text-top;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .text-muted {
            color: var(--text-muted) !important;
        }

        .text-primary {
            color: var(--text-primary) !important;
        }

        .text-secondary {
            color: var(--text-secondary) !important;
        }

        /* Dashboard Styles */
        .dashboard-container {
            padding: 20px;
        }

        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .module-card {
            background: var(--surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            padding: 1.5rem;
            border-left: 4px solid var(--primary-color);
            transition: var(--transition);
            border: 1px solid var(--border);
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        .module-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            opacity: 0;
            transition: var(--transition);
        }

        .module-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg), var(--shadow-glow);
            border-left-color: var(--accent-color);
        }

        .module-card:hover::before {
            opacity: 1;
        }

        .module-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .module-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        .module-status {
            padding: 0.375rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .status-running {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(5, 150, 105, 0.15) 100%);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-stopped {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.15) 0%, rgba(185, 28, 28, 0.15) 100%);
            color: var(--danger);
            border: 1px solid rgba(220, 38, 38, 0.3);
        }

        .module-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1.25rem;
            min-height: 40px;
            line-height: 1.5;
        }

        .module-actions {
            display: flex;
            gap: 0.75rem;
        }

        .btn-start {
            background: linear-gradient(135deg, var(--accent-color) 0%, #8b5cf6 100%);
            border: none;
            border-radius: 12px;
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 600;
            color: white;
            width: 100%;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .btn-start:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
        }

        .btn-stop {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            border: none;
            border-radius: 12px;
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 600;
            color: white;
            width: 100%;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .btn-stop:hover {
            background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.4);
        }

        /* Divider line */
        .divider-line {
            height: 2px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color), transparent);
            margin: 1.5rem 0;
            border-radius: 1px;
            opacity: 0.8;
        }

        /* Progress bar */
        .progress {
            height: 12px;
            background: var(--surface-alt);
            border-radius: 6px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }

        /* Floating particles for visual enhancement */
        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 50%;
            animation: float 8s ease-in-out infinite;
        }

        .particle:nth-child(1) {
            width: 4px;
            height: 4px;
            top: 20%;
            left: 20%;
            animation-delay: 0s;
        }

        .particle:nth-child(2) {
            width: 6px;
            height: 6px;
            top: 60%;
            left: 80%;
            animation-delay: 3s;
        }

        .particle:nth-child(3) {
            width: 3px;
            height: 3px;
            top: 80%;
            left: 30%;
            animation-delay: 6s;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
                opacity: 0.3;
            }
            50% {
                transform: translateY(-30px) rotate(180deg);
                opacity: 0.8;
            }
        }

        /* Responsive Design */
        @media (max-width: 991.98px) {
            .sidebar {
                width: 220px;
            }
            
            .main-content {
                margin-left: 220px;
                width: calc(100% - 220px);
            }
        }

        @media (max-width: 767.98px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                border-right: none;
                border-bottom: 1px solid var(--border);
            }
            
            .main-content {
                margin-left: 0;
                width: 100%;
                padding: 1rem;
            }
            
            .header-section {
                padding: 1rem;
            }
            
            .form-container {
                padding: 1rem;
            }
            
            .table-container {
                overflow-x: auto;
            }
            
            .batch-controls {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .batch-actions {
                justify-content: center;
            }
            
            .toggle-forms {
                flex-direction: column;
                gap: 0.25rem;
            }
            
            .action-buttons {
                flex-wrap: wrap;
            }
            
            .module-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .module-card {
                padding: 1.25rem;
            }
        }

        @media (max-width: 640px) {
            .main-content {
                padding: 0.75rem;
            }
            
            .summary-card {
                padding: 1rem;
            }
            
            .card-text {
                font-size: 1.5rem;
            }
            
            .btn {
                padding: 0.625rem 1.25rem;
                font-size: 0.8125rem;
            }
            
            .module-actions {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .module-actions .btn {
                width: 100%;
            }
        }

        /* Enhanced scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--surface-alt);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
        }

        /* Focus states for accessibility */
        *:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        .btn:focus,
        .form-control:focus {
            outline: none;
                        background: var(--surface);

        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="logo">
                    <i class="bi bi-twitter logo-icon"></i>
                    <span class="logo-text">Astral admin</span>
                </div>
                <div class="sidebar-divider"></div>
                <div class="position-sticky pt-1">
                    <ul class="nav flex-column">
                                       
                        <div class="px-3 mt-2 text-uppercase fw-bold small text-muted">Retweet Management</div>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-module="rtBot">
                                <i class="bi bi-arrow-repeat"></i> Retweet Bot
                            </a>
                        </li>
                        <!--
                        <div class="px-3 mt-2 text-uppercase fw-bold small text-muted">Control panel</div>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-module="dashboard">
                                <i class="bi bi-speedometer2"></i> Module Controller
                            </a>
                        </li>         
                        -->
                        <div class="px-3 mt-2 text-uppercase fw-bold small text-muted">Mass DM Management</div>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-module="massDm">
                                <i class="bi bi-chat-right-text-fill"></i> Mass DM
                            </a>
                        </li>
                        <div class="px-3 mt-2 text-uppercase fw-bold small text-muted">Group Management</div>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-module="groupAdder">
                                <i class="bi bi-plus-circle"></i> User Adder
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-module="groupBuilder">
                                <i class="bi bi-tools"></i> Group Builder
                            </a>
                        </li>
                    </ul>
                    <!-- Add this after the existing sidebar navigation items -->
<div class="px-3 mt-2 text-uppercase fw-bold small text-muted">System</div>
    <a class="nav-link" href="#" data-module="updates">
        <i class="bi bi-megaphone"></i> Updates
    </a>
                    <div class="sidebar-divider"></div>
<a href="/logout" class="logout-btn">
    <i class="bi bi-box-arrow-right"></i> Logout
</a>
                </div>
            </div>
<div class="main-content">
           
            <div id="rtBotModule" class="module-container">
    <div class="header-section">
        <h2><i class="bi bi-arrow-repeat"></i> Retweet Bot Control Panel</h2>
        <p class="text-muted">Manage your retweet bot accounts and monitor performance</p>
        <div class="btn-toolbar mt-3">
            <div class="btn-group me-2">
                <button type="button" class="btn btn-sm btn-outline-secondary" id="exportBtn">
                    <i class="bi bi-download"></i> Export
                </button>
                <button type="button" class="btn btn-sm btn-outline-secondary" id="importBtn">
                    <i class="bi bi-upload"></i> Import
                </button>
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary" id="addMultipleBtn">
                <i class="bi bi-plus-circle"></i> Batch Add
            </button>

              <!-- ADD THESE TWO NEW BUTTONS HERE -->
<div class="btn-group me-2">
    <button type="button" class="btn btn-sm btn-clear-progress" id="clearProgressBtn" onclick="clearProgress()">
        <i class="bi bi-trash"></i> Clear Progress File
    </button>
    <button type="button" class="btn btn-sm btn-scrape-groups" id="scrapeGroupsBtn" onclick="toggleScrapeGroups()">
        <i class="bi bi-search"></i> <span id="scrapeGroupsText">Scrape RT Groups</span>
    </button>
</div>
<!-- END OF NEW BUTTONS -->

<style>
/* Custom button styles to match the theme */
.btn-clear-progress {
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.15) 0%, rgba(245, 158, 11, 0.1) 100%);
    color: var(--warning);
    border: 1px solid rgba(245, 158, 11, 0.3);
    border-radius: var(--radius);
    transition: var(--transition);
    margin-left: 30px;
}

.btn-clear-progress:hover {
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.25) 0%, rgba(245, 158, 11, 0.2) 100%);
    color: #fff;
    border-color: var(--warning);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
}

.btn-scrape-groups {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(99, 102, 241, 0.1) 100%);
    color: var(--primary-color);
    border: 1px solid rgba(99, 102, 241, 0.3);
    border-radius: var(--radius);
    transition: var(--transition);
}

.btn-scrape-groups:hover {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.25) 0%, rgba(99, 102, 241, 0.2) 100%);
    color: #fff;
    border-color: var(--primary-color);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
}

.btn-scrape-groups.active {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
    color: white;
    border-color: var(--primary-color);
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
}

.btn-scrape-groups.stop {
    background: linear-gradient(135deg, rgba(220, 38, 38, 0.15) 0%, rgba(220, 38, 38, 0.1) 100%);
    color: var(--danger);
    border: 1px solid rgba(220, 38, 38, 0.3);
}

.btn-scrape-groups.stop:hover {
    background: linear-gradient(135deg, rgba(220, 38, 38, 0.25) 0%, rgba(220, 38, 38, 0.2) 100%);
    color: #fff;
    border-color: var(--danger);
    box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
}
</style>

<script>
let isScraping = false;

function clearProgress() {
    const btn = document.getElementById('clearProgressBtn');
    const originalHtml = btn.innerHTML;
    
    // Show loading state
    btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Clearing...';
    btn.disabled = true;
    
    // Call the backend function
    startBot('clearprogress');
    
    // Reset button after operation completes
    setTimeout(() => {
        btn.innerHTML = originalHtml;
        btn.disabled = false;
    }, 3000); // Adjust based on actual operation time
}

function toggleScrapeGroups() {
    const btn = document.getElementById('scrapeGroupsBtn');
    const text = document.getElementById('scrapeGroupsText');
    const icon = btn.querySelector('i');
    
    if (!isScraping) {
        // Start scraping
        isScraping = true;
        btn.classList.remove('btn-scrape-groups');
        btn.classList.add('btn-scrape-groups', 'stop');
        icon.className = 'bi bi-stop-fill';
        text.textContent = 'Stop Scraping';
        startBot('scrapegroups');
    } else {
        // Stop scraping
        isScraping = false;
        btn.classList.remove('stop');
        icon.className = 'bi bi-search';
        text.textContent = 'Scrape RT Groups';
        stopBot('scrapegroups');
    }
}

// Function to update button when scraping completes
function scrapingComplete(success = true) {
    isScraping = false;
    const btn = document.getElementById('scrapeGroupsBtn');
    const text = document.getElementById('scrapeGroupsText');
    const icon = btn.querySelector('i');
    
    if (success) {
        btn.classList.add('btn-scrape-groups', 'active');
        setTimeout(() => {
            btn.classList.remove('active');
        }, 2000);
    } else {
        btn.classList.remove('stop');
    }
    
    icon.className = 'bi bi-search';
    text.textContent = 'Scrape RT Groups';
}
</script>
            
            <div class="position-absolute top-0 end-0 me-3 mt-3">
                <div class="btn-group">
                    <button type="button" class="btn btn-sm btn-success" id="startRtBotBtn">
                        <i class="bi bi-play-circle"></i> Start RT Bot
                    </button>
                    <button type="button" class="btn btn-sm btn-danger" id="stopRtBotBtn">
                        <i class="bi bi-stop-circle"></i> Stop RT Bot
                    </button>
                
                </div>
            </div>
        </div>
        
    </div>



    <div class="row">
        
        <!-- Cycle Progress -->
         
        <div class="col-md-3 mb-3">
            <div class="summary-card">
                <h5 class="card-title">Cycle Progress</h5>
                <p class="card-text" id="cycleProgress">0/0</p>
                <div class="progress mt-2">
                    <div id="cycleProgressBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Total Drops -->
        <div class="col-md-3 mb-3">
            <div class="summary-card">
                <h5 class="card-title">Total Drops</h5>
                <p class="card-text" id="totalDrops">0</p>
                <small class="text-muted">Successful drops completed</small>
            </div>
        </div>

        <!-- Total Errors -->
        <div class="col-md-3 mb-3">
            <div class="summary-card">
                <h5 class="card-title">Total Errors</h5>
                <p class="card-text" id="totalErrors">0</p>
                <small class="text-muted">Errors encountered</small>
            </div>
        </div>

        <!-- Active Workers -->
        <div class="col-md-3 mb-3">
            <div class="summary-card">
                <h5 class="card-title">Active Workers</h5>
                <p class="card-text" id="activeWorkers">0</p>
                <small class="text-muted">Concurrent worker threads</small>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Runtime -->
        <div class="col-md-6 mb-3">
            <div class="summary-card">
                <h5 class="card-title">Runtime</h5>
                <p class="card-text" id="runtime">0:00:00.000000</p>
                <small class="text-muted">Time since last start</small>
            </div>
        </div>

        <!-- Profile Stats Summary -->
        <div class="col-md-6 mb-3">
            <div class="summary-card">
                <h5 class="card-title">Active Profiles</h5>
                <p class="card-text" id="activeProfiles">0</p>
                <small class="text-muted">Profiles currently working</small>
            </div>
        </div>
    </div>
<!-- Profile Statistics Table -->
<div class="table-container mt-4">
    <h4>Profile Statistics</h4>
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Profile ID</th>
                    <th>Model</th>
                    <th>Status</th>
                    <th>Drops</th>
                    <th>Errors</th>
                    <th>Last Action</th>
                </tr>
            </thead>
            <tbody id="profileStatsTable">
                <tr>
                    <td colspan="6" class="text-center py-4 text-muted">
                        <i class="bi bi-pause-circle fs-1 d-block mb-2"></i>
                        <span class="fs-5">Retweet Bot is Inactive</span>
                        <p class="mt-2 mb-0">Start the bot to see performance statistics</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<br>
    <!-- Account Management Section -->
    <div class="header-section mt-4">
        <h3><i class="bi bi-person-badge"></i> Account Management</h3>
        <p class="text-muted">Configure and manage your retweet bot accounts</p>
    </div>

    <!-- Summary Cards -->
    <div class="row">
        <div class="col-md-6 mb-3">
            <div class="summary-card">
                <h5 class="card-title">Total Accounts</h5>
                <p class="card-text" id="totalAccounts">0</p>
                <small class="text-muted">Number of slave accounts loaded</small>
            </div>
        </div>
        <div class="col-md-6 mb-3">
            <div class="summary-card">
                <h5 class="card-title">Total Groups</h5>
                <p class="card-text" id="totalGroups">0</p>
                <small class="text-muted">Retweet groups across all slaves</small>
            </div>
        </div>
    </div>
    
    
    <!-- Add Single Account Form -->
    <div class="form-container" id="singleAccountForm">
        <h4>Add New Account</h4>
        <form id="addForm">
            <div class="row g-3">
                <div class="col-md-3">
                    <label for="profile_id" class="form-label">Profile ID</label>
                    <input type="text" class="form-control" id="profile_id" required style="color: white;">
                </div>
                <div class="col-md-5">
                    <label for="message_file" class="form-label">Message File</label>
                    <input type="text" class="form-control" id="message_file" required style="color: white;">
                </div>
                <div class="col-md-3">
                    <label for="model_name" class="form-label">Model Name</label>
                    <input type="text" class="form-control" id="model_name" required style="color: white;">
                </div>
                <div class="col-md-1 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary">
                        <span id="addBtnText">Add</span>
                        <span id="addBtnSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
                    </button>
                </div>
            </div>
        </form>
    </div>


    
    <!-- Add Multiple Accounts Form (Initially Hidden) -->
    <div class="form-container d-none" id="multipleAccountsForm">
        <h4>Add Multiple Accounts</h4>
        <div class="mb-3">
            <label class="form-label">Enter accounts (one per line in format: profile_id,message_file,model_name)</label>
            <textarea class="form-control bulk-textarea" id="bulkAccounts" placeholder="profile1,message1.txt,model1&#10;profile2,message2.txt,model2"></textarea>
        </div>
        <div class="d-flex justify-content-end">
            <button type="button" class="btn btn-secondary me-2" id="cancelBulkAdd">
                Cancel
            </button>
            <button type="button" class="btn btn-primary" id="submitBulkAdd">
                <span id="bulkAddBtnText">Add Accounts</span>
                <span id="bulkAddBtnSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
            </button>
        </div>
    </div>
    
    <!-- Import Form (Initially Hidden) -->
    <div class="form-container d-none" id="importForm">
        <h4>Import Accounts</h4>
        <div class="mb-3">
            <label for="importFile" class="form-label">Select TXT file to import (format: profile_id,message_file,model_name)</label>
            <input class="form-control" type="file" id="importFile" accept=".txt">
        </div>
        <div class="d-flex justify-content-end">
            <button type="button" class="btn btn-secondary me-2" id="cancelImport">
                Cancel
            </button>
            <button type="button" class="btn btn-primary" id="submitImport">
                <span id="importBtnText">Import</span>
                <span id="importBtnSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
            </button>
        </div>
    </div>
    


    <!-- Configured Accounts Table -->
    <div class="table-container mt-4">
        <h4>Configured Accounts</h4>    
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Profile ID</th>
                        <th>Message File</th>
                        <th>Model Name</th>
                        <th class="text-center">Group Count</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="accountsTable" style="color: white;">
                    <!-- Accounts will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>
    
</div>



                <!-- Dashboard Module -->
                <div id="dashboardModule" class="module-container">
                    <div class="header-section">
                        <h2><i class="bi bi-speedometer2"></i> Bot Dashboard</h2>
                        <p class="text-muted">Launch and manage all bot modules from this centralized control panel</p>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="summary-card">
                                <h5 class="card-title">Active Modules</h5>
                                <p class="card-text" id="activeModulesCount">0</p>
                                <small class="text-muted">Number of currently running bot modules</small>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="summary-card">
                                <h5 class="card-title">Total Modules</h5>
                                <p class="card-text" id="totalModulesCount">0</p>
                                <small class="text-muted">Total number of available bot modules</small>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <h4>Bot Modules</h4>
                        <div class="module-grid" id="modulesGrid">
                            <!-- Modules will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Mass DM Module -->
                <div id="massDmModule" class="module-container">
                    <div class="header-section">
                        <h2><i class="bi bi-chat-right-text-fill"></i> Mass DM Settings</h2>
                        <p class="text-muted">Configure and manage your mass direct message campaigns</p>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> This module is currently under development. Check back soon for updates.
                    </div>
                </div>

                <!-- Updates Module -->
<div id="updatesModule" class="module-container">
    <div class="header-section">
        <h2><i class="bi bi-megaphone"></i> System Updates</h2>
        <p class="text-muted">Latest features, improvements, and upcoming changes</p>
    </div>

    <div class="row mb-4">
        <div class="col-md-6">
            <div class="summary-card">
                <h5 class="card-title">Total Updates</h5>
                <p class="card-text" id="totalUpdates">0</p>
                <small class="text-muted">Updates tracked in the system</small>
            </div>
        </div>
        <div class="col-md-6">
            <div class="summary-card">
                <h5 class="card-title">Recent Activity</h5>
                <p class="card-text" id="recentUpdates">0</p>
                <small class="text-muted">Updates in the last 30 days</small>
            </div>
        </div>
    </div>

    <div class="table-container">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="mb-0">Update History</h4>
            <div>
                <button class="btn btn-sm btn-outline-primary me-2" id="refreshUpdates">
                    <i class="bi bi-arrow-clockwise"></i> Refresh
                </button>
                <div class="btn-group">
                    <button type="button" class="btn btn-sm btn-outline-secondary active" data-filter="all">
                        All
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" data-filter="released">
                        Released
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" data-filter="upcoming">
                        Upcoming
                    </button>
                </div>
            </div>
        </div>
        
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Feature</th>
                        <th>Category</th>
                        <th>Status</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody id="updatesTable">
                    <tr>
                        <td colspan="5" class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2 mb-0">Loading updates...</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
/* Updates Module Styles */
#updatesTable tr td:first-child {
    white-space: nowrap;
    width: 120px;
}

#updatesTable tr td:nth-child(3),
#updatesTable tr td:nth-child(4) {
    white-space: nowrap;
    width: 140px;
}

.update-status-released {
    background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
    color: white;
}

.update-status-upcoming {
    background: linear-gradient(135deg, var(--info) 0%, var(--primary-light) 100%);
    color: white;
}

.update-status-development {
    background: linear-gradient(135deg, var(--warning) 0%, #f59e0b 100%);
    color: white;
}

.update-category-feature {
    background: rgba(99, 102, 241, 0.15);
    color: var(--primary-color);
}

.update-category-improvement {
    background: rgba(16, 185, 129, 0.15);
    color: var(--success);
}

.update-category-bugfix {
    background: rgba(220, 38, 38, 0.15);
    color: var(--danger);
}

.update-category-security {
    background: rgba(245, 158, 11, 0.15);
    color: var(--warning);
}
</style>

<script>
// Updates Module functionality
function setupUpdatesModule() {
    // Load updates when module is activated
    document.querySelector('[data-module="updates"]').addEventListener('click', function() {
        loadUpdatesFromAirtable();
    });
    
    // Refresh button
    document.getElementById('refreshUpdates').addEventListener('click', function() {
        loadUpdatesFromAirtable();
    });
    
    // Filter buttons
    document.querySelectorAll('[data-filter]').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('[data-filter]').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            const filter = this.getAttribute('data-filter');
            filterUpdates(filter);
        });
    });
}


// Function to load updates from Airtable
async function loadUpdatesFromAirtable() {
    const tbody = document.getElementById('updatesTable');
    
    try {
        // Show loading state
        tbody.innerHTML = `
            <tr>
                <td colspan="5" class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2 mb-0">Loading updates...</p>
                </td>
            </tr>
        `;
        
// Replace with your Airtable API endpoint and credentials
const response = await fetch('https://api.airtable.com/v0/app3RlS1UeBaeuNsm/Updates', {
    headers: {
        'Authorization': 'Bearer patWBgzmoKpZbgCZa.4d24d70eed8ad3f626ab0f03985145611a38f42b3007a3c4713fcd5fd2fe062e'
    }
});
        if (!response.ok) {
            throw new Error('Failed to fetch updates from Airtable');
        }
        
        const data = await response.json();
        renderUpdatesTable(data.records);
        updateSummaryCards(data.records);
        
    } catch (error) {
        console.error('Error loading updates:', error);
        
        // Fallback to sample data if Airtable fails
        const sampleData = getSampleUpdatesData();
        renderUpdatesTable(sampleData);
        updateSummaryCards(sampleData);
        
        showAlert('Using sample data. Configure Airtable integration for live updates.', 'warning');
    }
}

// Function to render updates table
function renderUpdatesTable(updates) {
    const tbody = document.getElementById('updatesTable');
    
    if (!updates || updates.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="5" class="text-center py-4">
                    <div class="empty-state">
                        <i class="bi bi-inbox"></i>
                        <h4>No updates available</h4>
                        <p>Check back later for new updates</p>
                    </div>
                </td>
            </tr>
        `;
        return;
    }
    
    // Sort updates by date (newest first)
    updates.sort((a, b) => new Date(b.fields?.date || b.date) - new Date(a.fields?.date || a.date));
    
    tbody.innerHTML = updates.map(update => {
        const fields = update.fields || update;
        const date = formatDate(fields.date);
        const status = fields.status || 'released';
        const category = fields.category || 'feature';
        
        return `
            <tr data-status="${status}">
                <td>${date}</td>
                <td><strong>${fields.title || 'Untitled Update'}</strong></td>
                <td><span class="badge update-category-${category}">${category.charAt(0).toUpperCase() + category.slice(1)}</span></td>
                <td><span class="badge update-status-${status}">${status.charAt(0).toUpperCase() + status.slice(1)}</span></td>
                <td>${fields.description || 'No description provided'}</td>
            </tr>
        `;
    }).join('');
}

// Function to filter updates
function filterUpdates(statusFilter) {
    const rows = document.querySelectorAll('#updatesTable tr');
    
    rows.forEach(row => {
        if (statusFilter === 'all') {
            row.style.display = '';
        } else {
            const rowStatus = row.getAttribute('data-status');
            row.style.display = rowStatus === statusFilter ? '' : 'none';
        }
    });
}

// Function to update summary cards
function updateSummaryCards(updates) {
    const totalUpdates = updates.length;
    
    // Calculate updates in the last 30 days
    const thirtyDaysAgo = new Date();
    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
    
    const recentUpdates = updates.filter(update => {
        const updateDate = new Date(update.fields?.date || update.date);
        return updateDate >= thirtyDaysAgo;
    }).length;
    
    document.getElementById('totalUpdates').textContent = totalUpdates;
    document.getElementById('recentUpdates').textContent = recentUpdates;
}

// Helper function to format date
function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric' 
    });
}

// Sample data for demonstration
function getSampleUpdatesData() {
    return [
        {
            fields: {
                title: "Retweet Bot Performance Dashboard",
                date: "2023-10-28",
                category: "feature",
                status: "released",
                description: "Added real-time performance tracking for the retweet bot"
            }
        },
        {
            fields: {
                title: "Batch Operations Enhancement",
                date: "2023-10-25",
                category: "improvement",
                status: "released",
                description: "Improved bulk import/export features with select all functionality"
            }
        },
        {
            fields: {
                title: "Authentication Security Fix",
                date: "2023-10-22",
                category: "security",
                status: "released",
                description: "Enhanced session management and security protocols"
            }
        },
        {
            fields: {
                title: "AI-Powered Content Generation",
                date: "2023-11-15",
                category: "feature",
                status: "upcoming",
                description: "Automated tweet generation using advanced AI models"
            }
        },
        {
            fields: {
                title: "Advanced Analytics Dashboard",
                date: "2023-11-30",
                category: "feature",
                status: "development",
                description: "Detailed performance metrics and engagement analytics"
            }
        }
    ];
}

// Initialize updates module when page loads
document.addEventListener('DOMContentLoaded', function() {
    setupUpdatesModule();
    
    // If updates module is active on page load, load data
    if (currentModule === 'updates') {
        loadUpdatesFromAirtable();
    }
});
</script>

                <!-- Group Adder Module -->
                <div id="groupAdderModule" class="module-container">
                    <div class="header-section">
                        <h2><i class="bi bi-plus-circle"></i> User Adder Settings</h2>
                        <p class="text-muted">Manage groups and users for adding to your communities</p>
                    </div>

                    <!-- Summary Cards -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="summary-card">
                                <h5 class="card-title">Total Group Links</h5>
                                <p class="card-text" id="totalGroupLinks">0</p>
                                <small class="text-muted">Groups that users will be added to</small>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="summary-card">
                                <h5 class="card-title">Total Users</h5>
                                <p class="card-text" id="totalUsers">0</p>
                                <small class="text-muted">Users that will be added to your groups</small>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Group Links Section -->
                        <div class="col-md-6">
                            <div class="form-container">
                                <div class="toggle-batch-buttons">
                                    <button type="button" class="btn btn-sm btn-primary active" id="singleGroupLinkBtn">
                                        Single Link
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-primary" id="batchGroupLinksBtn">
                                        Batch Links
                                    </button>
                                </div>
                                
                                <div id="singleGroupLinkForm">
                                    <h4>Add Group Link</h4>
                                    <div class="input-group mb-3">
                                        <input type="text" class="form-control" id="groupLinkInput" placeholder="Enter group link">
                                        <button class="btn btn-primary" type="button" id="addGroupLinkBtn">
                                            <span id="addGroupLinkText">Add</span>
                                            <span id="addGroupLinkSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
                                        </button>
                                    </div>
                                </div>
                                
                                <div id="batchGroupLinksForm" class="d-none">
                                    <h4>Add Batch Group Links</h4>
                                    <div class="mb-3">
                                        <label class="form-label">Enter group links (one per line)</label> 
                                        <textarea class="form-control bulk-textarea" id="batchGroupLinksInput" placeholder="https://x.com/messages/10290101&#10;https://x.com/messages/10921021"></textarea>
                                    </div>
                                    <div class="d-flex justify-content-end">
                                        <button type="button" class="btn btn-secondary me-2" id="cancelBatchGroupLinks">
                                            Cancel
                                        </button>
                                        <button type="button" class="btn btn-primary" id="submitBatchGroupLinks">
                                            <span id="batchGroupLinksBtnText">Add Links</span>
                                            <span id="batchGroupLinksBtnSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="table-container">
                                <div class="batch-controls">
                                    <div class="batch-selection-info" id="groupLinksSelectionInfo">
                                        0 group links selected
                                    </div>
                                    <div class="batch-actions">
                                        <button type="button" class="btn btn-sm btn-outline-danger" id="deleteSelectedGroupLinks" disabled>
                                            <i class="bi bi-trash"></i> Delete Selected 
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="selectAllGroupLinks">
                                            <i class="bi bi-check-square"></i> Select All
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="deselectAllGroupLinks" disabled>
                                            <i class="bi bi-square"></i> Deselect All
                                        </button>
                                    </div>
                                </div>
                                <h5>Group Links</h5>
                                <div id="groupLinksContainer">
                                    <!-- Group links will be loaded here -->
                                </div>
                            </div>
                        </div>

                        <!-- Users Section -->
                        <div class="col-md-6">
                            <div class="form-container">
                                <div class="toggle-batch-buttons">
                                    <button type="button" class="btn btn-sm btn-primary active" id="singleUserBtn">
                                        Single User
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-primary" id="batchUsersBtn">
                                        Batch Users
                                    </button>
                                </div>
                                
                                <div id="singleUserForm">
                                    <h4>Add User</h4>
                                    <div class="input-group mb-3">
                                        <input type="text" class="form-control" id="userInput" placeholder="Enter username">
                                        <button class="btn btn-primary" type="button" id="addUserBtn">
                                            <span id="addUserText">Add</span>
                                            <span id="addUserSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
                                        </button>
                                    </div>
                                </div>
                                
                                <div id="batchUsersForm" class="d-none">
                                    <h4>Add Batch Users</h4>
                                    <div class="mb-3">
                                        <label class="form-label">Enter usernames (one per line, without @)</label>
                                        <textarea class="form-control bulk-textarea" id="batchUsersInput" placeholder="user1&#10;user2"></textarea>
                                    </div>
                                    <div class="d-flex justify-content-end">
                                        <button type="button" class="btn btn-secondary me-2" id="cancelBatchUsers">
                                            Cancel
                                        </button>
                                        <button type="button" class="btn btn-primary" id="submitBatchUsers">
                                            <span id="batchUsersBtnText">Add Users</span>
                                            <span id="batchUsersBtnSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="table-container">
                                <div class="batch-controls">
                                    <div class="batch-selection-info" id="usersSelectionInfo">
                                        0 users selected
                                    </div>
                                    <div class="batch-actions">
                                        <button type="button" class="btn btn-sm btn-outline-danger" id="deleteSelectedUsers" disabled>
                                            <i class="bi bi-trash"></i> Delete Selected
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="selectAllUsers">
                                            <i class="bi bi-check-square"></i> Select All
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="deselectAllUsers" disabled>
                                            <i class="bi bi-square"></i> Deselect All
                                        </button>
                                    </div>
                                </div>
                                <h5>Users</h5>
                                <div id="usersContainer">
                                    <!-- Users will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Group Builder Module -->
                <div id="groupBuilderModule" class="module-container">
                    <div class="header-section">
                        <h2><i class="bi bi-tools"></i> Group Builder Settings</h2>
                        <p class="text-muted">Configure group building parameters and resources</p>
                    </div>

                    <div class="row">
                        <!-- Group Names Section -->
                        <div class="col-md-4">
                            <div class="form-container">
                                <div class="toggle-batch-buttons">
                                    <button type="button" class="btn btn-sm btn-primary active" id="singleGroupNameBtn">
                                        Single Name
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-primary" id="batchGroupNamesBtn">
                                        Batch Names
                                    </button>
                                </div>
                                
                                <div id="singleGroupNameForm">
                                    <h4>Add Group Name</h4>
                                    <div class="input-group mb-3">
                                        <input type="text" class="form-control" id="groupNameInput" placeholder="Enter group name">
                                        <button class="btn btn-primary" type="button" id="addGroupNameBtn">
                                            <span id="addGroupNameText">Add</span>
                                            <span id="addGroupNameSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
                                        </button>
                                    </div>
                                </div>
                                
                                <div id="batchGroupNamesForm" class="d-none">
                                    <h4>Add Batch Group Names</h4>
                                    <div class="mb-3">
                                        <label class="form-label">Enter group names (one per line)</label>
                                        <textarea class="form-control bulk-textarea" id="batchGroupNamesInput" placeholder="Group 1&#10;Group 2"></textarea>
                                    </div>
                                    <div class="d-flex justify-content-end">
                                        <button type="button" class="btn btn-secondary me-2" id="cancelBatchGroupNames">
                                            Cancel
                                        </button>
                                        <button type="button" class="btn btn-primary" id="submitBatchGroupNames">
                                            <span id="batchGroupNamesBtnText">Add Names</span>
                                            <span id="batchGroupNamesBtnSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="header-section mb-3">
                                <h5>Group Name Pool</h5>
                                <p class="text-muted mb-0">These names will be randomly selected when creating new groups</p>
                                <div class="divider-line"></div>
                            </div>
                            
                            <div class="table-container">
                                <div class="batch-controls">
                                    <div class="batch-selection-info" id="groupNamesSelectionInfo">
                                        0 group names selected
                                    </div>
                                    <div class="batch-actions">
                                        <button type="button" class="btn btn-sm btn-outline-danger" id="deleteSelectedGroupNames" disabled>
                                            <i class="bi bi-trash"></i> Delete Selected
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="selectAllGroupNames">
                                            <i class="bi bi-check-square"></i> Select All
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="deselectAllGroupNames" disabled>
                                            <i class="bi bi-square"></i> Deselect All
                                        </button>
                                    </div>
                                </div>
                                <div id="groupNamesContainer">
                                    <!-- Group names will be loaded here -->
                                </div>
                            </div>
                        </div>

                        <!-- Members to Add Section -->
                        <div class="col-md-4">
                            <div class="form-container">
                                <div class="toggle-batch-buttons">
                                    <button type="button" class="btn btn-sm btn-primary active" id="singleMemberBtn">
                                        Single Member
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-primary" id="batchMembersBtn">
                                        Batch Members
                                    </button>
                                </div>
                                
                                <div id="singleMemberForm">
                                    <h4>Add Member</h4>
                                    <div class="input-group mb-3">
                                        <input type="text" class="form-control" id="memberInput" placeholder="Enter member username">
                                        <button class="btn btn-primary" type="button" id="addMemberBtn">
                                            <span id="addMemberText">Add</span>
                                            <span id="addMemberSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
                                        </button>
                                    </div>
                                </div>
                                
                                <div id="batchMembersForm" class="d-none">
                                    <h4>Add Batch Members</h4>
                                    <div class="mb-3">
                                        <label class="form-label">Enter member usernames (one per line)</label>
                                        <textarea class="form-control bulk-textarea" id="batchMembersInput" placeholder="user1&#10;user2"></textarea>
                                    </div>
                                    <div class="d-flex justify-content-end">
                                        <button type="button" class="btn btn-secondary me-2" id="cancelBatchMembers">
                                            Cancel
                                        </button>
                                        <button type="button" class="btn btn-primary" id="submitBatchMembers">
                                            <span id="batchMembersBtnText">Add Members</span>
                                            <span id="batchMembersBtnSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="header-section mb-3">
                                <h5>Group User Pool</h5>
                                <p class="text-muted mb-0">Active users that will be added to freshly built groups</p>
                                <div class="divider-line"></div>
                            </div>
                            
                            <div class="table-container">
                                <div class="batch-controls">
                                    <div class="batch-selection-info" id="membersSelectionInfo">
                                        0 members selected
                                    </div>
                                    <div class="batch-actions">
                                        <button type="button" class="btn btn-sm btn-outline-danger" id="deleteSelectedMembers" disabled>
                                            <i class="bi bi-trash"></i> Delete Selected
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="selectAllMembers">
                                            <i class="bi bi-check-square"></i> Select All
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="deselectAllMembers" disabled>
                                            <i class="bi bi-square"></i> Deselect All
                                        </button>
                                    </div>
                                </div>
                                <div id="membersContainer">
                                    <!-- Members will be loaded here -->
                                </div>
                            </div>
                        </div>

                        <!-- Slave Accounts Section -->
                        <div class="col-md-4">
                            <div class="form-container">
                                <div class="toggle-batch-buttons">
                                    <button type="button" class="btn btn-sm btn-primary active" id="singleSlaveAccountBtn">
                                        Single Account
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-primary" id="batchSlaveAccountsBtn">
                                        Batch Accounts
                                    </button>
                                </div>
                                
                                <div id="singleSlaveAccountForm">
                                    <h4>Add Slave Account</h4>
                                    <div class="input-group mb-3">
                                        <input type="text" class="form-control" id="slaveAccountInput" placeholder="Enter account username">
                                        <button class="btn btn-primary" type="button" id="addSlaveAccountBtn">
                                            <span id="addSlaveAccountText">Add</span>
                                            <span id="addSlaveAccountSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
                                        </button>
                                    </div>
                                </div>
                                
                                <div id="batchSlaveAccountsForm" class="d-none">
                                    <h4>Add Batch Slave Accounts</h4>
                                    <div class="mb-3">
                                        <label class="form-label">Enter account usernames (one per line)</label>
                                        <textarea class="form-control bulk-textarea" id="batchSlaveAccountsInput" placeholder="account1&#10;account2"></textarea>
                                    </div>
                                    <div class="d-flex justify-content-end">
                                        <button type="button" class="btn btn-secondary me-2" id="cancelBatchSlaveAccounts">
                                            Cancel
                                        </button>
                                        <button type="button" class="btn btn-primary" id="submitBatchSlaveAccounts">
                                            <span id="batchSlaveAccountsBtnText">Add Accounts</span>
                                            <span id="batchSlaveAccountsBtnSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="header-section mb-3">
                                <h5>Slave Account Pool</h5>
                                <p class="text-muted mb-0">Accounts that will be added to all groups by default</p>
                                <div class="divider-line"></div>
                            </div>
                            
                            <div class="table-container">
                                <div class="batch-controls">
                                    <div class="batch-selection-info" id="slaveAccountsSelectionInfo">
                                        0 accounts selected
                                    </div>
                                    <div class="batch-actions">
                                        <button type="button" class="btn btn-sm btn-outline-danger" id="deleteSelectedSlaveAccounts" disabled>
                                            <i class="bi bi-trash"></i> Delete Selected
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="selectAllSlaveAccounts">
                                            <i class="bi bi-check-square"></i> Select All
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" id="deselectAllSlaveAccounts" disabled>
                                            <i class="bi bi-square"></i> Deselect All
                                        </button>
                                    </div>
                                </div>
                                <div id="slaveAccountsContainer">
                                    <!-- Slave accounts will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    

    <!-- Edit Modal -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Account</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <input type="hidden" id="editIndex">
                        <div class="mb-3">
                            <label for="editProfileId" class="form-label">Profile ID</label>
                            <input type="text" class="form-control" id="editProfileId" required>
                        </div>
                        <div class="mb-3">
                            <label for="editMessageFile" class="form-label">Message File</label>
                            <input type="text" class="form-control" id="editMessageFile" required>
                        </div>
                        <div class="mb-3">
                            <label for="editModelName" class="form-label">Model Name</label>
                            <input type="text" class="form-control" id="editModelName" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveChanges">
                        <span id="saveBtnText">Save changes</span>
                        <span id="saveBtnSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Global variables
    let currentModule = localStorage.getItem('currentModule') || 'dashboard';
    let accounts = [];
    let groupLinks = [];
    let users = [];
    let groupNames = [];
    let membersToAdd = [];
    let slaveAccounts = [];
    const editModal = new bootstrap.Modal(document.getElementById('editModal'));
    let selectedGroupLinks = [];
    let selectedUsers = [];
    let selectedGroupNames = [];
    let selectedMembers = [];
    let selectedSlaveAccounts = [];
    let apiEndpoints = {
        accounts: '/api/rt-bot/list',
        addAccount: '/api/rt-bot/add',
        deleteAccount: '/api/rt-bot/delete',
        updateAccount: '/api/rt-bot/update',
        botStats: '/api/twitter-bot/stats', // Changed to GET endpoint
        botStart: '/api/bot/start',
        botStop: '/api/bot/stop',
        botStatus: '/api/bot/status',
        groupLinks: '/api/group-adder/group-links',
        addGroupLink: '/api/group-adder/group-links/add',
        deleteGroupLink: '/api/group-adder/group-links/delete',
        users: '/api/group-adder/users',
        addUser: '/api/group-adder/users/add',
        deleteUser: '/api/group-adder/users/delete'
    };
    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
        // Set active module from localStorage
        document.querySelectorAll('.sidebar .nav-link').forEach(navLink => {
            navLink.classList.remove('active');
            if (navLink.getAttribute('data-module') === currentModule) {
                navLink.classList.add('active');
            }
        });

        document.querySelectorAll('.module-container').forEach(module => {
            module.classList.remove('active');
            if (module.id === currentModule + 'Module') {
                module.classList.add('active');
            }
        });

        setupNavigation();
        setupRTBotModule();
        setupGroupAdderModule();
        setupGroupBuilderModule();
        loadAccounts();
        loadGroupLinks();
        loadUsers();
        loadGroupNames();
        loadMembersToAdd();
        loadSlaveAccounts();
        loadModules();
        
        // Check bot status immediately on page load
        checkBotStatus();
        
        // Set up periodic status checks
       // Set up periodic status checks
        setInterval(checkBotStatus, 5000);
        
        
        // If we're on the RT bot page, fetch stats immediately
// If we're on the RT bot page, fetch stats immediately
    if (currentModule === 'rtBot' || currentModule === 'progressDashboard') {
        fetchBotStats();
    }
    });

    // Module navigation setup
    function setupNavigation() {
        document.querySelectorAll('[data-module]').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Update active state in sidebar
                document.querySelectorAll('.sidebar .nav-link').forEach(navLink => {
                    navLink.classList.remove('active');
                });
                this.classList.add('active');
                
                // Hide all modules
                document.querySelectorAll('.module-container').forEach(module => {
                    module.classList.remove('active');
                });
                
                // Show selected module
                currentModule = this.getAttribute('data-module');
                localStorage.setItem('currentModule', currentModule);
                const moduleId = currentModule + 'Module';
                document.getElementById(moduleId).classList.add('active');

                // Load data when switching to specific modules
                if (currentModule === 'groupAdder') {
                    loadGroupLinks();
                    loadUsers();
                } else if (currentModule === 'groupBuilder') {
                    loadGroupNames();
                    loadMembersToAdd();
                    loadSlaveAccounts();
                } else if (currentModule === 'dashboard') {
                    loadModules();
                }
                
                // If we're on the RT bot page, fetch stats immediately
                if (currentModule === 'rtBot' || currentModule === 'progressDashboard') {
                    fetchBotStats();
                }
            });
        });
    }

    // Update summary cards
    function updateSummaryCards() {
        const totalAccounts = accounts.length;
        const totalGroups = accounts.reduce((sum, account) => sum + (account.group_count || 0), 0);
        
        document.getElementById('totalAccounts').textContent = totalAccounts;
        document.getElementById('totalGroups').textContent = totalGroups;
    }

    function updateGroupAdderSummary() {
        document.getElementById('totalGroupLinks').textContent = groupLinks.length;
        document.getElementById('totalUsers').textContent = users.length;
    }

    // RT Bot Module setup
    function setupRTBotModule() {
        // Add new account
        document.getElementById('addForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const addBtn = document.querySelector('#addForm button[type="submit"]');
            const addBtnText = document.getElementById('addBtnText');
            const addBtnSpinner = document.getElementById('addBtnSpinner');
            
            // Show loading state
            addBtnText.textContent = 'Adding...';
            addBtnSpinner.classList.remove('d-none');
            addBtn.disabled = true;
            
            try {
                const response = await fetch(apiEndpoints.addAccount, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        profile_id: document.getElementById('profile_id').value,
                        message_file: document.getElementById('message_file').value,
                        model_name: document.getElementById('model_name').value
                    })
                });
                
                if (!response.ok) {
                    throw new Error(await response.text());
                }
                
                const data = await response.json();
                accounts.push(data);
                addRowToTable(data, accounts.length - 1);
                document.getElementById('addForm').reset();
                updateSummaryCards();
                showAlert('Account added successfully!', 'success');
            } catch (error) {
                console.error('Error adding account:', error);
                showAlert('Error adding account: ' + error.message, 'danger');
            } finally {
                // Restore button state
                addBtnText.textContent = 'Add';
                addBtnSpinner.classList.add('d-none');
                addBtn.disabled = false;
            }
        });
        
        // Save edited account
        document.getElementById('saveChanges').addEventListener('click', async function() {
            const saveBtn = this;
            const saveBtnText = document.getElementById('saveBtnText');
            const saveBtnSpinner = document.getElementById('saveBtnSpinner');
            
            // Show loading state
            saveBtnText.textContent = 'Saving...';
            saveBtnSpinner.classList.remove('d-none');
            saveBtn.disabled = true;
            
            try {
                const index = document.getElementById('editIndex').value;
                const response = await fetch(apiEndpoints.updateAccount, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        index: index,
                        profile_id: document.getElementById('editProfileId').value,
                        message_file: document.getElementById('editMessageFile').value,
                        model_name: document.getElementById('editModelName').value
                    })
                });
                
                if (!response.ok) {
                    throw new Error(await response.text());
                }
                
                const data = await response.json();
                accounts[index] = data;
                
                // Update the table row
                const row = document.getElementById(`row-${index}`);
                if (row) {
                    const cells = row.getElementsByTagName('td');
                    cells[0].textContent = data.profile_id;
                    cells[1].textContent = data.message_file;
                    cells[2].textContent = data.model_name;
                    cells[3].innerHTML = `<span class="badge group-count-badge">${data.group_count || 0}</span>`;
                }
                
                updateSummaryCards();
                editModal.hide();
                showAlert('Account updated successfully!', 'success');
            } catch (error) {
                console.error('Error updating account:', error);
                showAlert('Error updating account: ' + error.message, 'danger');
            } finally {
                // Restore button state
                saveBtnText.textContent = 'Save changes';
                saveBtnSpinner.classList.add('d-none');
                saveBtn.disabled = false;
            }
        });
        
        // Export functionality
        document.getElementById('exportBtn').addEventListener('click', function() {
            exportAccountsToTxt();
        });
        
        // Import functionality
        document.getElementById('importBtn').addEventListener('click', function() {
            document.getElementById('singleAccountForm').classList.add('d-none');
            document.getElementById('multipleAccountsForm').classList.add('d-none');
            document.getElementById('importForm').classList.remove('d-none');
        });
        
        // Cancel import
        document.getElementById('cancelImport').addEventListener('click', function() {
            document.getElementById('importForm').classList.add('d-none');
            document.getElementById('singleAccountForm').classList.remove('d-none');
            document.getElementById('importFile').value = '';
        });
        
        // Submit import
        document.getElementById('submitImport').addEventListener('click', async function() {
            const fileInput = document.getElementById('importFile');
            const submitBtn = this;
            const submitBtnText = document.getElementById('importBtnText');
            const submitBtnSpinner = document.getElementById('importBtnSpinner');
            
            if (!fileInput.files || fileInput.files.length === 0) {
                showAlert('Please select a file to import', 'warning');
                return;
            }
            
            // Show loading state
            submitBtnText.textContent = 'Importing...';
            submitBtnSpinner.classList.remove('d-none');
            submitBtn.disabled = true;
            
            try {
                const file = fileInput.files[0];
                const fileContent = await readFileAsText(file);
                const lines = fileContent.split('\n').filter(line => line.trim());
                let importedCount = 0;
                
                for (const line of lines) {
                    const parts = line.split(',').map(part => part.trim());
                    if (parts.length < 3) continue;
                    
                    const [profile_id, message_file, model_name] = parts;
                    
                    try {
                        const response = await fetch(apiEndpoints.addAccount, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                profile_id,
                                message_file,
                                model_name
                            })
                        });
                        
                        if (!response.ok) {
                            console.error('Error adding account:', await response.text());
                            continue;
                        }
                        
                        const data = await response.json();
                        accounts.push(data);
                        addRowToTable(data, accounts.length - 1);
                        importedCount++;
                    } catch (error) {
                        console.error('Error adding account:', error);
                    }
                }
                
                updateSummaryCards();
                showAlert(`Successfully imported ${importedCount} accounts`, 'success');
                document.getElementById('importForm').classList.add('d-none');
                document.getElementById('singleAccountForm').classList.remove('d-none');
                document.getElementById('importFile').value = '';
            } catch (error) {
                console.error('Error importing accounts:', error);
                showAlert('Error importing accounts: ' + error.message, 'danger');
            } finally {
                // Restore button state
                submitBtnText.textContent = 'Import';
                submitBtnSpinner.classList.add('d-none');
                submitBtn.disabled = false;
            }
        });
        
        // Add multiple accounts functionality
        document.getElementById('addMultipleBtn').addEventListener('click', function() {
            document.getElementById('singleAccountForm').classList.add('d-none');
            document.getElementById('importForm').classList.add('d-none');
            document.getElementById('multipleAccountsForm').classList.remove('d-none');
            document.getElementById('bulkAccounts').focus();
        });
        
        // Cancel bulk add
        document.getElementById('cancelBulkAdd').addEventListener('click', function() {
            document.getElementById('multipleAccountsForm').classList.add('d-none');
            document.getElementById('singleAccountForm').classList.remove('d-none');
            document.getElementById('bulkAccounts').value = '';
        });
        
        // Submit bulk add
        document.getElementById('submitBulkAdd').addEventListener('click', async function() {
            const bulkText = document.getElementById('bulkAccounts').value.trim();
            const submitBtn = this;
            const submitBtnText = document.getElementById('bulkAddBtnText');
            const submitBtnSpinner = document.getElementById('bulkAddBtnSpinner');
            
            if (!bulkText) {
                showAlert('Please enter accounts to add', 'warning');
                return;
            }
            
            // Show loading state
            submitBtnText.textContent = 'Adding...';
            submitBtnSpinner.classList.remove('d-none');
            submitBtn.disabled = true;
            
            try {
                const lines = bulkText.split('\n').filter(line => line.trim());
                let addedCount = 0;
                
                for (const line of lines) {
                    const parts = line.split(',').map(part => part.trim());
                    if (parts.length < 3) continue;
                    
                    const [profile_id, message_file, model_name] = parts;
                    
                    try {
                        const response = await fetch(apiEndpoints.addAccount, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                profile_id,
                                message_file,
                                model_name
                            })
                        });
                        
                        if (!response.ok) {
                            console.error('Error adding account:', await response.text());
                            continue;
                        }
                        
                        const data = await response.json();
                        accounts.push(data);
                        addRowToTable(data, accounts.length - 1);
                        addedCount++;
                    } catch (error) {
                        console.error('Error adding account:', error);
                    }
                }
                
                updateSummaryCards();
                showAlert(`Successfully added ${addedCount} accounts`, 'success');
                document.getElementById('multipleAccountsForm').classList.add('d-none');
                document.getElementById('singleAccountForm').classList.remove('d-none');
                document.getElementById('bulkAccounts').value = '';
            } catch (error) {
                console.error('Error adding accounts:', error);
                showAlert('Error adding accounts: ' + error.message, 'danger');
            } finally {
                // Restore button state
                submitBtnText.textContent = 'Add Accounts';
                submitBtnSpinner.classList.add('d-none');
                submitBtn.disabled = false;
            }
        });

        // Bot control functions
        document.getElementById('startRtBotBtn').addEventListener('click', function() {
            startBot('retweetbot');
        });

        document.getElementById('stopRtBotBtn').addEventListener('click', function() {
            stopBot('retweetbot');
        });
    }

    // Group Adder Module setup
    function setupGroupAdderModule() {
        // Toggle between single and batch group links
        document.getElementById('singleGroupLinkBtn').addEventListener('click', function() {
            document.getElementById('singleGroupLinkBtn').classList.remove('btn-outline-primary');
            document.getElementById('singleGroupLinkBtn').classList.add('btn-primary');
            document.getElementById('batchGroupLinksBtn').classList.remove('btn-primary');
            document.getElementById('batchGroupLinksBtn').classList.add('btn-outline-primary');
            document.getElementById('singleGroupLinkForm').classList.remove('d-none');
            document.getElementById('batchGroupLinksForm').classList.add('d-none');
        });

        document.getElementById('batchGroupLinksBtn').addEventListener('click', function() {
            document.getElementById('batchGroupLinksBtn').classList.remove('btn-outline-primary');
            document.getElementById('batchGroupLinksBtn').classList.add('btn-primary');
            document.getElementById('singleGroupLinkBtn').classList.remove('btn-primary');
            document.getElementById('singleGroupLinkBtn').classList.add('btn-outline-primary');
            document.getElementById('singleGroupLinkForm').classList.add('d-none');
            document.getElementById('batchGroupLinksForm').classList.remove('d-none');
        });

        // Toggle between single and batch users
        document.getElementById('singleUserBtn').addEventListener('click', function() {
            document.getElementById('singleUserBtn').classList.remove('btn-outline-primary');
            document.getElementById('singleUserBtn').classList.add('btn-primary');
            document.getElementById('batchUsersBtn').classList.remove('btn-primary');
            document.getElementById('batchUsersBtn').classList.add('btn-outline-primary');
            document.getElementById('singleUserForm').classList.remove('d-none');
            document.getElementById('batchUsersForm').classList.add('d-none');
        });

        document.getElementById('batchUsersBtn').addEventListener('click', function() {
            document.getElementById('batchUsersBtn').classList.remove('btn-outline-primary');
            document.getElementById('batchUsersBtn').classList.add('btn-primary');
            document.getElementById('singleUserBtn').classList.remove('btn-primary');
            document.getElementById('singleUserBtn').classList.add('btn-outline-primary');
            document.getElementById('singleUserForm').classList.add('d-none');
            document.getElementById('batchUsersForm').classList.remove('d-none');
        });

        // Add group link
        document.getElementById('addGroupLinkBtn').addEventListener('click', async function() {
            const input = document.getElementById('groupLinkInput');
            const link = input.value.trim();
            const btn = this;
            const btnText = document.getElementById('addGroupLinkText');
            const btnSpinner = document.getElementById('addGroupLinkSpinner');

            if (!link) {
                showAlert('Please enter a group link', 'warning');
                return;
            }

            // Show loading state
            btnText.textContent = 'Adding...';
            btnSpinner.classList.remove('d-none');
            btn.disabled = true;

            try {
                const response = await fetch(apiEndpoints.addGroupLink, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ link: link })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to add group link');
                }

                const data = await response.json();
                groupLinks.push(link);
                renderGroupLinks();
                updateGroupAdderSummary();
                input.value = '';
                showAlert('Group link added successfully!', 'success');
            } catch (error) {
                console.error('Error adding group link:', error);
                showAlert('Error adding group link: ' + error.message, 'danger');
            } finally {
                // Restore button state
                btnText.textContent = 'Add';
                btnSpinner.classList.add('d-none');
                btn.disabled = false;
            }
        });

        // Add batch group links
        document.getElementById('submitBatchGroupLinks').addEventListener('click', async function() {
            const textarea = document.getElementById('batchGroupLinksInput');
            const links = textarea.value.trim();
            const btn = this;
            const btnText = document.getElementById('batchGroupLinksBtnText');
            const btnSpinner = document.getElementById('batchGroupLinksBtnSpinner');

            if (!links) {
                showAlert('Please enter group links to add', 'warning');
                return;
            }

            // Show loading state
            btnText.textContent = 'Adding...';
            btnSpinner.classList.remove('d-none');
            btn.disabled = true;

            try {
                const linksArray = links.split('\n').filter(link => link.trim());
                let addedCount = 0;

                for (const link of linksArray) {
                    try {
                        const response = await fetch(apiEndpoints.addGroupLink, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ link: link.trim() })
                        });

                        if (!response.ok) {
                            console.error('Error adding group link:', await response.text());
                            continue;
                        }

                        const data = await response.json();
                        groupLinks.push(link.trim());
                        addedCount++;
                    } catch (error) {
                        console.error('Error adding group link:', error);
                    }
                }

                renderGroupLinks();
                updateGroupAdderSummary();
                textarea.value = '';
                showAlert(`Successfully added ${addedCount} group links!`, 'success');
                document.getElementById('singleGroupLinkBtn').click();
            } catch (error) {
                console.error('Error adding batch group links:', error);
                showAlert('Error adding batch group links: ' + error.message, 'danger');
            } finally {
                // Restore button state
                btnText.textContent = 'Add Links';
                btnSpinner.classList.add('d-none');
                btn.disabled = false;
            }
        });

        // Cancel batch group links
        document.getElementById('cancelBatchGroupLinks').addEventListener('click', function() {
            document.getElementById('batchGroupLinksInput').value = '';
            document.getElementById('singleGroupLinkBtn').click();
        });

        // Add user
        document.getElementById('addUserBtn').addEventListener('click', async function() {
            const input = document.getElementById('userInput');
            const user = input.value.trim();
            const btn = this;
            const btnText = document.getElementById('addUserText');
            const btnSpinner = document.getElementById('addUserSpinner');

            if (!user) {
                showAlert('Please enter a username', 'warning');
                return;
            }

            // Show loading state
            btnText.textContent = 'Adding...';
            btnSpinner.classList.remove('d-none');
            btn.disabled = true;

            try {
                const response = await fetch(apiEndpoints.addUser, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ user: user })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to add user');
                }

                const data = await response.json();
                users.push(user);
                renderUsers();
                updateGroupAdderSummary();
                input.value = '';
                showAlert('User added successfully!', 'success');
            } catch (error) {
                console.error('Error adding user:', error);
                showAlert('Error adding user: ' + error.message, 'danger');
            } finally {
                // Restore button state
                btnText.textContent = 'Add';
                btnSpinner.classList.add('d-none');
                btn.disabled = false;
            }
        });

        // Add batch users
        document.getElementById('submitBatchUsers').addEventListener('click', async function() {
            const textarea = document.getElementById('batchUsersInput');
            const usersText = textarea.value.trim();
            const btn = this;
            const btnText = document.getElementById('batchUsersBtnText');
            const btnSpinner = document.getElementById('batchUsersBtnSpinner');

            if (!usersText) {
                showAlert('Please enter users to add', 'warning');
                return;
            }

            // Show loading state
            btnText.textContent = 'Adding...';
            btnSpinner.classList.remove('d-none');
            btn.disabled = true;

            try {
                const usersArray = usersText.split('\n').filter(user => user.trim());
                let addedCount = 0;

                for (const user of usersArray) {
                    try {
                        const response = await fetch(apiEndpoints.addUser, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ user: user.trim() })
                        });

                        if (!response.ok) {
                            console.error('Error adding user:', await response.text());
                            continue;
                        }

                        const data = await response.json();
                        users.push(user.trim());
                        addedCount++;
                    } catch (error) {
                        console.error('Error adding user:', error);
                    }
                }

                renderUsers();
                updateGroupAdderSummary();
                textarea.value = '';
                showAlert(`Successfully added ${addedCount} users!`, 'success');
                document.getElementById('singleUserBtn').click();
            } catch (error) {
                console.error('Error adding batch users:', error);
                showAlert('Error adding batch users: ' + error.message, 'danger');
            } finally {
                // Restore button state
                btnText.textContent = 'Add Users';
                btnSpinner.classList.add('d-none');
                btn.disabled = false;
            }
        });

        // Cancel batch users
        document.getElementById('cancelBatchUsers').addEventListener('click', function() {
            document.getElementById('batchUsersInput').value = '';
            document.getElementById('singleUserBtn').click();
        });

        // Allow Enter key to submit
        document.getElementById('groupLinkInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('addGroupLinkBtn').click();
            }
        });

        document.getElementById('userInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('addUserBtn').click();
            }
        });

        // Batch selection functionality for group links
        document.getElementById('selectAllGroupLinks').addEventListener('click', function() {
            selectedGroupLinks = [...groupLinks];
            renderGroupLinks();
            updateGroupLinksSelectionUI();
        });

        document.getElementById('deselectAllGroupLinks').addEventListener('click', function() {
            selectedGroupLinks = [];
            renderGroupLinks();
            updateGroupLinksSelectionUI();
        });

        document.getElementById('deleteSelectedGroupLinks').addEventListener('click', async function() {
            if (selectedGroupLinks.length === 0) {
                showAlert('No group links selected', 'warning');
                return;
            }

            if (!confirm(`Are you sure you want to delete ${selectedGroupLinks.length} selected group links?`)) {
                return;
            }

            const btn = this;
            const btnText = btn.querySelector('span:first-child');
            const btnSpinner = document.createElement('span');
            btnSpinner.className = 'spinner-border spinner-border-sm d-none';
            btnSpinner.setAttribute('role', 'status');
            btn.appendChild(btnSpinner);

            // Show loading state
            btnText.textContent = 'Deleting...';
            btnSpinner.classList.remove('d-none');
            btn.disabled = true;

            try {
                // Create a copy of the selected links to avoid modification during iteration
                const linksToDelete = [...selectedGroupLinks];
                let deletedCount = 0;

                for (const link of linksToDelete) {
                    const index = groupLinks.indexOf(link);
                    if (index === -1) continue;

                    try {
                        const response = await fetch(apiEndpoints.deleteGroupLink, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ index: index })
                        });

                        if (!response.ok) {
                            console.error('Error deleting group link:', await response.text());
                            continue;
                        }

                        groupLinks.splice(index, 1);
                        const selectedIndex = selectedGroupLinks.indexOf(link);
                        if (selectedIndex !== -1) {
                            selectedGroupLinks.splice(selectedIndex, 1);
                        }
                        deletedCount++;
                    } catch (error) {
                        console.error('Error deleting group link:', error);
                    }
                }

                renderGroupLinks();
                updateGroupAdderSummary();
                showAlert(`Successfully deleted ${deletedCount} group links!`, 'success');
            } catch (error) {
                console.error('Error deleting selected group links:', error);
                showAlert('Error deleting selected group links: ' + error.message, 'danger');
            } finally {
                // Restore button state
                btnText.textContent = 'Delete Selected';
                btnSpinner.classList.add('d-none');
                btn.disabled = true;
            }
        });

        // Batch selection functionality for users
        document.getElementById('selectAllUsers').addEventListener('click', function() {
            selectedUsers = [...users];
            renderUsers();
            updateUsersSelectionUI();
        });

        document.getElementById('deselectAllUsers').addEventListener('click', function() {
            selectedUsers = [];
            renderUsers();
            updateUsersSelectionUI();
        });

        document.getElementById('deleteSelectedUsers').addEventListener('click', async function() {
            if (selectedUsers.length === 0) {
                showAlert('No users selected', 'warning');
                return;
            }

            if (!confirm(`Are you sure you want to delete ${selectedUsers.length} selected users?`)) {
                return;
            }

            const btn = this;
            const btnText = btn.querySelector('span:first-child');
            const btnSpinner = document.createElement('span');
            btnSpinner.className = 'spinner-border spinner-border-sm d-none';
            btnSpinner.setAttribute('role', 'status');
            btn.appendChild(btnSpinner);

            // Show loading state
            btnText.textContent = 'Deleting...';
            btnSpinner.classList.remove('d-none');
            btn.disabled = true;

            try {
                // Create a copy of the selected users to avoid modification during iteration
                const usersToDelete = [...selectedUsers];
                let deletedCount = 0;

                for (const user of usersToDelete) {
                    const index = users.indexOf(user);
                    if (index === -1) continue;

                    try {
                        const response = await fetch(apiEndpoints.deleteUser, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ index: index })
                        });

                        if (!response.ok) {
                            console.error('Error deleting user:', await response.text());
                            continue;
                        }

                        users.splice(index, 1);
                        const selectedIndex = selectedUsers.indexOf(user);
                        if (selectedIndex !== -1) {
                            selectedUsers.splice(selectedIndex, 1);
                        }
                        deletedCount++;
                    } catch (error) {
                        console.error('Error deleting user:', error);
                    }
                }

                renderUsers();
                updateGroupAdderSummary();
                showAlert(`Successfully deleted ${deletedCount} users!`, 'success');
            } catch (error) {
                console.error('Error deleting selected users:', error);
                showAlert('Error deleting selected users: ' + error.message, 'danger');
            } finally {
                // Restore button state
                btnText.textContent = 'Delete Selected';
                btnSpinner.classList.add('d-none');
                btn.disabled = true;
            }
        });
    }

    // Group Builder Module setup
    function setupGroupBuilderModule() {
        // Group Names Section
        setupGroupNamesSection();
        
        // Members to Add Section
        setupMembersSection();
        
        // Slave Accounts Section
        setupSlaveAccountsSection();
    }

    function setupGroupNamesSection() {
        // Toggle between single and batch group names
        document.getElementById('singleGroupNameBtn').addEventListener('click', function() {
            document.getElementById('singleGroupNameBtn').classList.remove('btn-outline-primary');
            document.getElementById('singleGroupNameBtn').classList.add('btn-primary');
            document.getElementById('batchGroupNamesBtn').classList.remove('btn-primary');
            document.getElementById('batchGroupNamesBtn').classList.add('btn-outline-primary');
            document.getElementById('singleGroupNameForm').classList.remove('d-none');
            document.getElementById('batchGroupNamesForm').classList.add('d-none');
        });

        document.getElementById('batchGroupNamesBtn').addEventListener('click', function() {
            document.getElementById('batchGroupNamesBtn').classList.remove('btn-outline-primary');
            document.getElementById('batchGroupNamesBtn').classList.add('btn-primary');
            document.getElementById('singleGroupNameBtn').classList.remove('btn-primary');
            document.getElementById('singleGroupNameBtn').classList.add('btn-outline-primary');
            document.getElementById('singleGroupNameForm').classList.add('d-none');
            document.getElementById('batchGroupNamesForm').classList.remove('d-none');
        });

        // Add group name
        document.getElementById('addGroupNameBtn').addEventListener('click', async function() {
            const input = document.getElementById('groupNameInput');
            const name = input.value.trim();
            const btn = this;
            const btnText = document.getElementById('addGroupNameText');
            const btnSpinner = document.getElementById('addGroupNameSpinner');

            if (!name) {
                showAlert('Please enter a group name', 'warning');
                return;
            }

            btnText.textContent = 'Adding...';
            btnSpinner.classList.remove('d-none');
            btn.disabled = true;

            try {
                const response = await fetch('/api/group-builder/group-names/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name: name })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to add group name');
                }

                const data = await response.json();
                loadGroupNames();
                input.value = '';
                showAlert('Group name added successfully!', 'success');
            } catch (error) {
                console.error('Error adding group name:', error);
                showAlert('Error adding group name: ' + error.message, 'danger');
            } finally {
                btnText.textContent = 'Add';
                btnSpinner.classList.add('d-none');
                btn.disabled = false;
            }
        });

        // Add batch group names
        document.getElementById('submitBatchGroupNames').addEventListener('click', async function() {
            const textarea = document.getElementById('batchGroupNamesInput');
            const names = textarea.value.trim();
            const btn = this;
            const btnText = document.getElementById('batchGroupNamesBtnText');
            const btnSpinner = document.getElementById('batchGroupNamesBtnSpinner');

            if (!names) {
                showAlert('Please enter group names to add', 'warning');
                return;
            }

            btnText.textContent = 'Adding...';
            btnSpinner.classList.remove('d-none');
            btn.disabled = true;

            try {
                const namesArray = names.split('\n').filter(name => name.trim());
                const response = await fetch('/api/group-builder/group-names/batch-add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ names: namesArray })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to add batch group names');
                }

                const data = await response.json();
                loadGroupNames();
                textarea.value = '';
                showAlert(`Successfully added ${data.added_count} group names!`, 'success');
                document.getElementById('singleGroupNameBtn').click();
            } catch (error) {
                console.error('Error adding batch group names:', error);
                showAlert('Error adding batch group names: ' + error.message, 'danger');
            } finally {
                btnText.textContent = 'Add Names';
                btnSpinner.classList.add('d-none');
                btn.disabled = false;
            }
        });

        // Cancel batch group names
        document.getElementById('cancelBatchGroupNames').addEventListener('click', function() {
            document.getElementById('batchGroupNamesInput').value = '';
            document.getElementById('singleGroupNameBtn').click();
        });

        // Batch selection functionality for group names
        document.getElementById('selectAllGroupNames').addEventListener('click', function() {
            const checkboxes = document.querySelectorAll('#groupNamesContainer .list-item-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
                const listItem = checkbox.closest('.list-item');
                const name = listItem.getAttribute('data-name');
                if (!selectedGroupNames.includes(name)) {
                    selectedGroupNames.push(name);
                }
            });
            updateGroupNamesSelectionUI();
        });

        document.getElementById('deselectAllGroupNames').addEventListener('click', function() {
            const checkboxes = document.querySelectorAll('#groupNamesContainer .list-item-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            selectedGroupNames = [];
            updateGroupNamesSelectionUI();
        });

        document.getElementById('deleteSelectedGroupNames').addEventListener('click', async function() {
            if (selectedGroupNames.length === 0) {
                showAlert('No group names selected', 'warning');
                return;
            }

            if (!confirm(`Are you sure you want to delete ${selectedGroupNames.length} selected group names?`)) {
                return;
            }

            const btn = this;
            const btnText = btn.querySelector('span:first-child');
            const btnSpinner = document.createElement('span');
            btnSpinner.className = 'spinner-border spinner-border-sm d-none';
            btnSpinner.setAttribute('role', 'status');
            btn.appendChild(btnSpinner);

            btnText.textContent = 'Deleting...';
            btnSpinner.classList.remove('d-none');
            btn.disabled = true;

            try {
                const indices = [];
                const groupNames = await fetchGroupNames();
                
                for (const name of selectedGroupNames) {
                    const index = groupNames.indexOf(name);
                    if (index !== -1) {
                        indices.push(index);
                    }
                }

                const response = await fetch('/api/group-builder/group-names/batch-delete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ indices: indices })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to delete selected group names');
                }

                const data = await response.json();
                loadGroupNames();
                showAlert(`Successfully deleted ${data.deleted_count} group names!`, 'success');
            } catch (error) {
                console.error('Error deleting selected group names:', error);
                showAlert('Error deleting selected group names: ' + error.message, 'danger');
            } finally {
                btnText.textContent = 'Delete Selected';
                btnSpinner.classList.add('d-none');
                btn.disabled = true;
            }
        });
    }

    function setupMembersSection() {
        // Toggle between single and batch members
        document.getElementById('singleMemberBtn').addEventListener('click', function() {
            document.getElementById('singleMemberBtn').classList.remove('btn-outline-primary');
            document.getElementById('singleMemberBtn').classList.add('btn-primary');
            document.getElementById('batchMembersBtn').classList.remove('btn-primary');
            document.getElementById('batchMembersBtn').classList.add('btn-outline-primary');
            document.getElementById('singleMemberForm').classList.remove('d-none');
            document.getElementById('batchMembersForm').classList.add('d-none');
        });

        document.getElementById('batchMembersBtn').addEventListener('click', function() {
            document.getElementById('batchMembersBtn').classList.remove('btn-outline-primary');
            document.getElementById('batchMembersBtn').classList.add('btn-primary');
            document.getElementById('singleMemberBtn').classList.remove('btn-primary');
            document.getElementById('singleMemberBtn').classList.add('btn-outline-primary');
            document.getElementById('singleMemberForm').classList.add('d-none');
            document.getElementById('batchMembersForm').classList.remove('d-none');
        });

        // Add member
        document.getElementById('addMemberBtn').addEventListener('click', async function() {
            const input = document.getElementById('memberInput');
            const member = input.value.trim();
            const btn = this;
            const btnText = document.getElementById('addMemberText');
            const btnSpinner = document.getElementById('addMemberSpinner');

            if (!member) {
                showAlert('Please enter a member username', 'warning');
                return;
            }

            btnText.textContent = 'Adding...';
            btnSpinner.classList.remove('d-none');
            btn.disabled = true;

            try {
                const response = await fetch('/api/group-builder/members-to-add/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ member: member })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to add member');
                }

                const data = await response.json();
                loadMembersToAdd();
                input.value = '';
                showAlert('Member added successfully!', 'success');
            } catch (error) {
                console.error('Error adding member:', error);
                showAlert('Error adding member: ' + error.message, 'danger');
            } finally {
                btnText.textContent = 'Add';
                btnSpinner.classList.add('d-none');
                btn.disabled = false;
            }
        });

        // Add batch members
        document.getElementById('submitBatchMembers').addEventListener('click', async function() {
            const textarea = document.getElementById('batchMembersInput');
            const members = textarea.value.trim();
            const btn = this;
            const btnText = document.getElementById('batchMembersBtnText');
            const btnSpinner = document.getElementById('batchMembersBtnSpinner');

            if (!members) {
                showAlert('Please enter members to add', 'warning');
                return;
            }

            btnText.textContent = 'Adding...';
            btnSpinner.classList.remove('d-none');
            btn.disabled = true;

            try {
                const membersArray = members.split('\n').filter(member => member.trim());
                const response = await fetch('/api/group-builder/members-to-add/batch-add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ members: membersArray })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to add batch members');
                }

                const data = await response.json();
                loadMembersToAdd();
                textarea.value = '';
                showAlert(`Successfully added ${data.added_count} members!`, 'success');
                document.getElementById('singleMemberBtn').click();
            } catch (error) {
                console.error('Error adding batch members:', error);
                showAlert('Error adding batch members: ' + error.message, 'danger');
            } finally {
                btnText.textContent = 'Add Members';
                btnSpinner.classList.add('d-none');
                btn.disabled = false;
            }
        });

        // Cancel batch members
        document.getElementById('cancelBatchMembers').addEventListener('click', function() {
            document.getElementById('batchMembersInput').value = '';
            document.getElementById('singleMemberBtn').click();
        });

        // Batch selection functionality for members
        document.getElementById('selectAllMembers').addEventListener('click', function() {
            const checkboxes = document.querySelectorAll('#membersContainer .list-item-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
                const listItem = checkbox.closest('.list-item');
                const member = listItem.getAttribute('data-member');
                if (!selectedMembers.includes(member)) {
                    selectedMembers.push(member);
                }
            });
            updateMembersSelectionUI();
        });

        document.getElementById('deselectAllMembers').addEventListener('click', function() {
            const checkboxes = document.querySelectorAll('#membersContainer .list-item-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            selectedMembers = [];
            updateMembersSelectionUI();
        });

        document.getElementById('deleteSelectedMembers').addEventListener('click', async function() {
            if (selectedMembers.length === 0) {
                showAlert('No members selected', 'warning');
                return;
            }

            if (!confirm(`Are you sure you want to delete ${selectedMembers.length} selected members?`)) {
                return;
            }

            const btn = this;
            const btnText = btn.querySelector('span:first-child');
            const btnSpinner = document.createElement('span');
            btnSpinner.className = 'spinner-border spinner-border-sm d-none';
            btnSpinner.setAttribute('role', 'status');
            btn.appendChild(btnSpinner);

            btnText.textContent = 'Deleting...';
            btnSpinner.classList.remove('d-none');
            btn.disabled = true;

            try {
                const indices = [];
                const members = await fetchMembersToAdd();
                
                for (const member of selectedMembers) {
                    const index = members.indexOf(member);
                    if (index !== -1) {
                        indices.push(index);
                    }
                }

                const response = await fetch('/api/group-builder/members-to-add/batch-delete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ indices: indices })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to delete selected members');
                }

                const data = await response.json();
                loadMembersToAdd();
                showAlert(`Successfully deleted ${data.deleted_count} members!`, 'success');
            } catch (error) {
                console.error('Error deleting selected members:', error);
                showAlert('Error deleting selected members: ' + error.message, 'danger');
            } finally {
                btnText.textContent = 'Delete Selected';
                btnSpinner.classList.add('d-none');
                btn.disabled = true;
            }
        });
    }

    function setupSlaveAccountsSection() {
        // Toggle between single and batch slave accounts
        document.getElementById('singleSlaveAccountBtn').addEventListener('click', function() {
            document.getElementById('singleSlaveAccountBtn').classList.remove('btn-outline-primary');
            document.getElementById('singleSlaveAccountBtn').classList.add('btn-primary');
            document.getElementById('batchSlaveAccountsBtn').classList.remove('btn-primary');
            document.getElementById('batchSlaveAccountsBtn').classList.add('btn-outline-primary');
            document.getElementById('singleSlaveAccountForm').classList.remove('d-none');
            document.getElementById('batchSlaveAccountsForm').classList.add('d-none');
        });

        document.getElementById('batchSlaveAccountsBtn').addEventListener('click', function() {
            document.getElementById('batchSlaveAccountsBtn').classList.remove('btn-outline-primary');
            document.getElementById('batchSlaveAccountsBtn').classList.add('btn-primary');
            document.getElementById('singleSlaveAccountBtn').classList.remove('btn-primary');
            document.getElementById('singleSlaveAccountBtn').classList.add('btn-outline-primary');
            document.getElementById('singleSlaveAccountForm').classList.add('d-none');
            document.getElementById('batchSlaveAccountsForm').classList.remove('d-none');
        });

        // Add slave account
        document.getElementById('addSlaveAccountBtn').addEventListener('click', async function() {
            const input = document.getElementById('slaveAccountInput');
            const account = input.value.trim();
            const btn = this;
            const btnText = document.getElementById('addSlaveAccountText');
            const btnSpinner = document.getElementById('addSlaveAccountSpinner');

            if (!account) {
                showAlert('Please enter an account username', 'warning');
                return;
            }

            btnText.textContent = 'Adding...';
            btnSpinner.classList.remove('d-none');
            btn.disabled = true;

            try {
                const response = await fetch('/api/group-builder/slave-accounts/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ account: account })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to add slave account');
                }

                const data = await response.json();
                loadSlaveAccounts();
                input.value = '';
                showAlert('Slave account added successfully!', 'success');
            } catch (error) {
                console.error('Error adding slave account:', error);
                showAlert('Error adding slave account: ' + error.message, 'danger');
            } finally {
                btnText.textContent = 'Add';
                btnSpinner.classList.add('d-none');
                btn.disabled = false;
            }
        });

        // Add batch slave accounts
        document.getElementById('submitBatchSlaveAccounts').addEventListener('click', async function() {
            const textarea = document.getElementById('batchSlaveAccountsInput');
            const accounts = textarea.value.trim();
            const btn = this;
            const btnText = document.getElementById('batchSlaveAccountsBtnText');
            const btnSpinner = document.getElementById('batchSlaveAccountsBtnSpinner');

            if (!accounts) {
                showAlert('Please enter accounts to add', 'warning');
                return;
            }

            btnText.textContent = 'Adding...';
            btnSpinner.classList.remove('d-none');
            btn.disabled = true;

            try {
                const accountsArray = accounts.split('\n').filter(account => account.trim());
                const response = await fetch('/api/group-builder/slave-accounts/batch-add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ accounts: accountsArray })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to add batch slave accounts');
                }

                const data = await response.json();
                loadSlaveAccounts();
                textarea.value = '';
                showAlert(`Successfully added ${data.added_count} slave accounts!`, 'success');
                document.getElementById('singleSlaveAccountBtn').click();
            } catch (error) {
                console.error('Error adding batch slave accounts:', error);
                showAlert('Error adding batch slave accounts: ' + error.message, 'danger');
            } finally {
                btnText.textContent = 'Add Accounts';
                btnSpinner.classList.add('d-none');
                btn.disabled = false;
            }
        });

        // Cancel batch slave accounts
        document.getElementById('cancelBatchSlaveAccounts').addEventListener('click', function() {
            document.getElementById('batchSlaveAccountsInput').value = '';
            document.getElementById('singleSlaveAccountBtn').click();
        });

        // Batch selection functionality for slave accounts
        document.getElementById('selectAllSlaveAccounts').addEventListener('click', function() {
            const checkboxes = document.querySelectorAll('#slaveAccountsContainer .list-item-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
                const listItem = checkbox.closest('.list-item');
                const account = listItem.getAttribute('data-account');
                if (!selectedSlaveAccounts.includes(account)) {
                    selectedSlaveAccounts.push(account);
                }
            });
            updateSlaveAccountsSelectionUI();
        });

        document.getElementById('deselectAllSlaveAccounts').addEventListener('click', function() {
            const checkboxes = document.querySelectorAll('#slaveAccountsContainer .list-item-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            selectedSlaveAccounts = [];
            updateSlaveAccountsSelectionUI();
        });

        document.getElementById('deleteSelectedSlaveAccounts').addEventListener('click', async function() {
            if (selectedSlaveAccounts.length === 0) {
                showAlert('No slave accounts selected', 'warning');
                return;
            }

            if (!confirm(`Are you sure you want to delete ${selectedSlaveAccounts.length} selected slave accounts?`)) {
                return;
            }

            const btn = this;
            const btnText = btn.querySelector('span:first-child');
            const btnSpinner = document.createElement('span');
            btnSpinner.className = 'spinner-border spinner-border-sm d-none';
            btnSpinner.setAttribute('role', 'status');
            btn.appendChild(btnSpinner);

            btnText.textContent = 'Deleting...';
            btnSpinner.classList.remove('d-none');
            btn.disabled = true;

            try {
                const indices = [];
                const accounts = await fetchSlaveAccounts();
                
                for (const account of selectedSlaveAccounts) {
                    const index = accounts.indexOf(account);
                    if (index !== -1) {
                        indices.push(index);
                    }
                }

                const response = await fetch('/api/group-builder/slave-accounts/batch-delete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ indices: indices })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to delete selected slave accounts');
                }

                const data = await response.json();
                loadSlaveAccounts();
                showAlert(`Successfully deleted ${data.deleted_count} slave accounts!`, 'success');
            } catch (error) {
                console.error('Error deleting selected slave accounts:', error);
                showAlert('Error deleting selected slave accounts: ' + error.message, 'danger');
            } finally {
                btnText.textContent = 'Delete Selected';
                btnSpinner.classList.add('d-none');
                btn.disabled = true;
            }
        });
    }

    // Group Builder data functions
    async function fetchGroupNames() {
        try {
            const response = await fetch('/api/group-builder/group-names');
            if (!response.ok) {
                throw new Error('Failed to load group names');
            }
            const data = await response.json();
            return data.names || [];
        } catch (error) {
            console.error('Error fetching group names:', error);
            showAlert('Error loading group names: ' + error.message, 'danger');
            return [];
        }
    }

    async function loadGroupNames() {
        try {
            const names = await fetchGroupNames();
            groupNames = names;
            renderGroupNames(groupNames);
            selectedGroupNames = [];
            updateGroupNamesSelectionUI();
        } catch (error) {
            console.error('Error loading group names:', error);
            showAlert('Error loading group names: ' + error.message, 'danger');
        }
    }

    function renderGroupNames(names) {
        const container = document.getElementById('groupNamesContainer');
        
        if (names.length === 0) {
            container.innerHTML = `
                <div class="no-items">
                    <i class="bi bi-card-heading"></i>
                    <p>No group names added yet</p>
                </div>
            `;
            return;
        }

        container.innerHTML = names.map((name, index) => {
            const isSelected = selectedGroupNames.includes(name);
            return `
                <div class="list-item ${isSelected ? 'selected' : ''}" data-name="${name}">
                    <div class="form-check">
                        <input class="form-check-input list-item-checkbox" type="checkbox" 
                               id="groupNameCheckbox-${index}" 
                               ${isSelected ? 'checked' : ''}>
                        <label class="form-check-label" for="groupNameCheckbox-${index}">
                            <span class="list-item-text">${name}</span>
                        </label>
                    </div>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteGroupName(${index})">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            `;
        }).join('');

        container.querySelectorAll('.list-item-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const listItem = this.closest('.list-item');
                const name = listItem.getAttribute('data-name');
                
                if (this.checked) {
                    if (!selectedGroupNames.includes(name)) {
                        selectedGroupNames.push(name);
                        listItem.classList.add('selected');
                    }
                } else {
                    const index = selectedGroupNames.indexOf(name);
                    if (index !== -1) {
                        selectedGroupNames.splice(index, 1);
                        listItem.classList.remove('selected');
                    }
                }
                
                updateGroupNamesSelectionUI();
            });
        });
    }

    function updateGroupNamesSelectionUI() {
        const infoElement = document.getElementById('groupNamesSelectionInfo');
        const deleteBtn = document.getElementById('deleteSelectedGroupNames');
        const deselectAllBtn = document.getElementById('deselectAllGroupNames');
        
        infoElement.textContent = `${selectedGroupNames.length} group names selected`;
        
        if (selectedGroupNames.length > 0) {
            deleteBtn.disabled = false;
            deselectAllBtn.disabled = false;
        } else {
            deleteBtn.disabled = true;
            deselectAllBtn.disabled = true;
        }
    }

    async function deleteGroupName(index) {
        if (!confirm('Are you sure you want to delete this group name?')) {
            return;
        }

        try {
            const response = await fetch('/api/group-builder/group-names/delete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ index: index })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'Failed to delete group name');
            }

            const data = await response.json();
            loadGroupNames();
            showAlert('Group name deleted successfully!', 'success');
        } catch (error) {
            console.error('Error deleting group name:', error);
            showAlert('Error deleting group name: ' + error.message, 'danger');
        }
    }

    async function fetchMembersToAdd() {
        try {
            const response = await fetch('/api/group-builder/members-to-add');
            if (!response.ok) {
                throw new Error('Failed to load members');
            }
            const data = await response.json();
            return data.members || [];
        } catch (error) {
            console.error('Error fetching members:', error);
            showAlert('Error loading members: ' + error.message, 'danger');
            return [];
        }
    }

    async function loadMembersToAdd() {
        try {
            const members = await fetchMembersToAdd();
            membersToAdd = members;
            renderMembersToAdd(membersToAdd);
            selectedMembers = [];
            updateMembersSelectionUI();
        } catch (error) {
            console.error('Error loading members:', error);
            showAlert('Error loading members: ' + error.message, 'danger');
        }
    }

    function renderMembersToAdd(members) {
        const container = document.getElementById('membersContainer');
        
        if (members.length === 0) {
            container.innerHTML = `
                <div class="no-items">
                    <i class="bi bi-people"></i>
                    <p>No members added yet</p>
                </div>
            `;
            return;
        }

        container.innerHTML = members.map((member, index) => {
            const isSelected = selectedMembers.includes(member);
            return `
                <div class="list-item ${isSelected ? 'selected' : ''}" data-member="${member}">
                    <div class="form-check">
                        <input class="form-check-input list-item-checkbox" type="checkbox" 
                               id="memberCheckbox-${index}" 
                               ${isSelected ? 'checked' : ''}>
                        <label class="form-check-label" for="memberCheckbox-${index}">
                            <span class="list-item-text">@${member}</span>
                        </label>
                    </div>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteMember(${index})">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            `;
        }).join('');

        container.querySelectorAll('.list-item-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const listItem = this.closest('.list-item');
                const member = listItem.getAttribute('data-member');
                
                if (this.checked) {
                    if (!selectedMembers.includes(member)) {
                        selectedMembers.push(member);
                        listItem.classList.add('selected');
                    }
                } else {
                    const index = selectedMembers.indexOf(member);
                    if (index !== -1) {
                        selectedMembers.splice(index, 1);
                        listItem.classList.remove('selected');
                    }
                }
                
                updateMembersSelectionUI();
            });
        });
    }

    function updateMembersSelectionUI() {
        const infoElement = document.getElementById('membersSelectionInfo');
        const deleteBtn = document.getElementById('deleteSelectedMembers');
        const deselectAllBtn = document.getElementById('deselectAllMembers');
        
        infoElement.textContent = `${selectedMembers.length} members selected`;
        
        if (selectedMembers.length > 0) {
            deleteBtn.disabled = false;
            deselectAllBtn.disabled = false;
        } else {
            deleteBtn.disabled = true;
            deselectAllBtn.disabled = true;
        }
    }

    async function deleteMember(index) {
        if (!confirm('Are you sure you want to delete this member?')) {
            return;
        }

        try {
            const response = await fetch('/api/group-builder/members-to-add/delete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ index: index })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'Failed to delete member');
            }

            const data = await response.json();
            loadMembersToAdd();
            showAlert('Member deleted successfully!', 'success');
        } catch (error) {
            console.error('Error deleting member:', error);
            showAlert('Error deleting member: ' + error.message, 'danger');
        }
    }

    async function fetchSlaveAccounts() {
        try {
            const response = await fetch('/api/group-builder/slave-accounts');
            if (!response.ok) {
                throw new Error('Failed to load slave accounts');
            }
            const data = await response.json();
            return data.accounts || [];
        } catch (error) {
            console.error('Error fetching slave accounts:', error);
            showAlert('Error loading slave accounts: ' + error.message, 'danger');
            return [];
        }
    }

    async function loadSlaveAccounts() {
        try {
            const accounts = await fetchSlaveAccounts();
            slaveAccounts = accounts;
            renderSlaveAccounts(slaveAccounts);
            selectedSlaveAccounts = [];
            updateSlaveAccountsSelectionUI();
        } catch (error) {
            console.error('Error loading slave accounts:', error);
            showAlert('Error loading slave accounts: ' + error.message, 'danger');
        }
    }

    function renderSlaveAccounts(accounts) {
        const container = document.getElementById('slaveAccountsContainer');
        
        if (accounts.length === 0) {
            container.innerHTML = `
                <div class="no-items">
                    <i class="bi bi-person-badge"></i>
                    <p>No slave accounts added yet</p>
                </div>
            `;
            return;
        }

        container.innerHTML = accounts.map((account, index) => {
            const isSelected = selectedSlaveAccounts.includes(account);
            return `
                <div class="list-item ${isSelected ? 'selected' : ''}" data-account="${account}">
                    <div class="form-check">
                        <input class="form-check-input list-item-checkbox" type="checkbox" 
                               id="slaveAccountCheckbox-${index}" 
                               ${isSelected ? 'checked' : ''}>
                        <label class="form-check-label" for="slaveAccountCheckbox-${index}">
                            <span class="list-item-text">@${account}</span>
                        </label>
                    </div>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteSlaveAccount(${index})">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            `;
        }).join('');

        container.querySelectorAll('.list-item-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const listItem = this.closest('.list-item');
                const account = listItem.getAttribute('data-account');
                
                if (this.checked) {
                    if (!selectedSlaveAccounts.includes(account)) {
                        selectedSlaveAccounts.push(account);
                        listItem.classList.add('selected');
                    }
                } else {
                    const index = selectedSlaveAccounts.indexOf(account);
                    if (index !== -1) {
                        selectedSlaveAccounts.splice(index, 1);
                        listItem.classList.remove('selected');
                    }
                }
                
                updateSlaveAccountsSelectionUI();
            });
        });
    }

    function updateSlaveAccountsSelectionUI() {
        const infoElement = document.getElementById('slaveAccountsSelectionInfo');
        const deleteBtn = document.getElementById('deleteSelectedSlaveAccounts');
        const deselectAllBtn = document.getElementById('deselectAllSlaveAccounts');
        
        infoElement.textContent = `${selectedSlaveAccounts.length} accounts selected`;
        
        if (selectedSlaveAccounts.length > 0) {
            deleteBtn.disabled = false;
            deselectAllBtn.disabled = false;
        } else {
            deleteBtn.disabled = true;
            deselectAllBtn.disabled = true;
        }
    }

    async function deleteSlaveAccount(index) {
        if (!confirm('Are you sure you want to delete this slave account?')) {
            return;
        }

        try {
            const response = await fetch('/api/group-builder/slave-accounts/delete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ index: index })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'Failed to delete slave account');
            }

            const data = await response.json();
            loadSlaveAccounts();
            showAlert('Slave account deleted successfully!', 'success');
        } catch (error) {
            console.error('Error deleting slave account:', error);
            showAlert('Error deleting slave account: ' + error.message, 'danger');
        }
    }

    // Load data functions
    async function loadAccounts() {
        try {
            const response = await fetch(apiEndpoints.accounts);
            if (!response.ok) {
                throw new Error('Failed to load accounts');
            }
            accounts = await response.json();
            renderAccountsTable();
            updateSummaryCards();
        } catch (error) {
            console.error('Error loading accounts:', error);
            showAlert('Error loading accounts: ' + error.message, 'danger');
            
            // Show empty state in table
            const tbody = document.getElementById('accountsTable');
            tbody.innerHTML = `
                <tr>
                    <td colspan="5" class="text-center py-4">
                        <div class="empty-state">
                            <i class="bi bi-exclamation-triangle"></i>
                            <h4>Failed to load accounts</h4>
                            <p>${error.message}</p>
                            <button class="btn btn-primary mt-2" onclick="loadAccounts()">Retry</button>
                        </div>
                    </td>
                </tr>
            `;
        }
    }

    async function loadGroupLinks() {
        try {
            const response = await fetch(apiEndpoints.groupLinks);
            if (!response.ok) {
                throw new Error('Failed to load group links');
            }
            const data = await response.json();
            groupLinks = data.links || [];
            selectedGroupLinks = [];
            renderGroupLinks();
            updateGroupAdderSummary();
            updateGroupLinksSelectionUI();
        } catch (error) {
            console.error('Error loading group links:', error);
            showAlert('Error loading group links: ' + error.message, 'danger');
        }
    }

    async function loadUsers() {
        try {
            const response = await fetch(apiEndpoints.users);
            if (!response.ok) {
                throw new Error('Failed to load users');
            }
            const data = await response.json();
            users = data.users || [];
            selectedUsers = [];
            renderUsers();
            updateGroupAdderSummary();
            updateUsersSelectionUI();
        } catch (error) {
            console.error('Error loading users:', error);
            showAlert('Error loading users: ' + error.message, 'danger');
        }
    }

    // Render functions
    function renderAccountsTable() {
        const tbody = document.getElementById('accountsTable');
        tbody.innerHTML = '';
        
        if (accounts.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="5" class="text-center py-4">
                        <div class="empty-state">
                            <i class="bi bi-inbox"></i>
                            <h4>No accounts configured</h4>
                            <p>Add your first account to get started</p>
                        </div>
                    </td>
                </tr>
            `;
            return;
        }
        
        accounts.forEach((account, index) => {
            addRowToTable(account, index);
        });
    }

    function renderGroupLinks() {
        const container = document.getElementById('groupLinksContainer');
        
        if (groupLinks.length === 0) {
            container.innerHTML = `
                <div class="no-items">
                    <i class="bi bi-link"></i>
                    <p>No group links added yet</p>
                </div>
            `;
            return;
        }

        container.innerHTML = groupLinks.map((link, index) => {
            const isSelected = selectedGroupLinks.includes(link);
            return `
                <div class="list-item ${isSelected ? 'selected' : ''}" data-link="${link}">
                    <div class="form-check">
                        <input class="form-check-input list-item-checkbox" type="checkbox" 
                               id="groupLinkCheckbox-${index}" 
                               ${isSelected ? 'checked' : ''}>
                        <label class="form-check-label" for="groupLinkCheckbox-${index}">
                            <span class="list-item-text">${link}</span>
                        </label>
                    </div>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteGroupLink(${index})">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            `;
        }).join('');

        // Add event listeners to checkboxes
        container.querySelectorAll('.list-item-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const listItem = this.closest('.list-item');
                const link = listItem.getAttribute('data-link');
                
                if (this.checked) {
                    if (!selectedGroupLinks.includes(link)) {
                        selectedGroupLinks.push(link);
                        listItem.classList.add('selected');
                    }
                } else {
                    const index = selectedGroupLinks.indexOf(link);
                    if (index !== -1) {
                        selectedGroupLinks.splice(index, 1);
                        listItem.classList.remove('selected');
                    }
                }
                
                updateGroupLinksSelectionUI();
            });
        });
    }

    function renderUsers() {
        const container = document.getElementById('usersContainer');
        
        if (users.length === 0) {
            container.innerHTML = `
                <div class="no-items">
                    <i class="bi bi-person"></i>
                    <p>No users added yet</p>
                </div>
            `;
            return;
        }

        container.innerHTML = users.map((user, index) => {
            const isSelected = selectedUsers.includes(user);
            return `
                <div class="list-item ${isSelected ? 'selected' : ''}" data-user="${user}">
                    <div class="form-check">
                        <input class="form-check-input list-item-checkbox" type="checkbox" 
                               id="userCheckbox-${index}" 
                               ${isSelected ? 'checked' : ''}>
                        <label class="form-check-label" for="userCheckbox-${index}">
                            <span class="list-item-text">@${user}</span>
                        </label>
                    </div>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteUser(${index})">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            `;
        }).join('');

        // Add event listeners to checkboxes
        container.querySelectorAll('.list-item-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const listItem = this.closest('.list-item');
                const user = listItem.getAttribute('data-user');
                
                if (this.checked) {
                    if (!selectedUsers.includes(user)) {
                        selectedUsers.push(user);
                        listItem.classList.add('selected');
                    }
                } else {
                    const index = selectedUsers.indexOf(user);
                    if (index !== -1) {
                        selectedUsers.splice(index, 1);
                        listItem.classList.remove('selected');
                    }
                }
                
                updateUsersSelectionUI();
            });
        });
    }

    function updateGroupLinksSelectionUI() {
        const infoElement = document.getElementById('groupLinksSelectionInfo');
        const deleteBtn = document.getElementById('deleteSelectedGroupLinks');
        const deselectAllBtn = document.getElementById('deselectAllGroupLinks');
        
        infoElement.textContent = `${selectedGroupLinks.length} group links selected`;
        
        if (selectedGroupLinks.length > 0) {
            deleteBtn.disabled = false;
            deselectAllBtn.disabled = false;
        } else {
            deleteBtn.disabled = true;
            deselectAllBtn.disabled = true;
        }
    }

    function updateUsersSelectionUI() {
        const infoElement = document.getElementById('usersSelectionInfo');
        const deleteBtn = document.getElementById('deleteSelectedUsers');
        const deselectAllBtn = document.getElementById('deselectAllUsers');
        
        infoElement.textContent = `${selectedUsers.length} users selected`;
        
        if (selectedUsers.length > 0) {
            deleteBtn.disabled = false;
            deselectAllBtn.disabled = false;
        } else {
            deleteBtn.disabled = true;
            deselectAllBtn.disabled = true;
        }
    }

    // Delete functions for Group Adder
    async function deleteGroupLink(index) {
        if (!confirm('Are you sure you want to delete this group link?')) {
            return;
        }

        try {
            const response = await fetch(apiEndpoints.deleteGroupLink, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ index: index })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'Failed to delete group link');
            }

            const link = groupLinks[index];
            groupLinks.splice(index, 1);
            
            // Remove from selected if it was there
            const selectedIndex = selectedGroupLinks.indexOf(link);
            if (selectedIndex !== -1) {
                selectedGroupLinks.splice(selectedIndex, 1);
            }
            
            renderGroupLinks();
            updateGroupAdderSummary();
            updateGroupLinksSelectionUI();
            showAlert('Group link deleted successfully!', 'success');
        } catch (error) {
            console.error('Error deleting group link:', error);
            showAlert('Error deleting group link: ' + error.message, 'danger');
        }
    }

    async function deleteUser(index) {
        if (!confirm('Are you sure you want to delete this user?')) {
            return;
        }

        try {
            const response = await fetch(apiEndpoints.deleteUser, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ index: index })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'Failed to delete user');
            }

            const user = users[index];
            users.splice(index, 1);
            
            // Remove from selected if it was there
            const selectedIndex = selectedUsers.indexOf(user);
            if (selectedIndex !== -1) {
                selectedUsers.splice(selectedIndex, 1);
            }
            
            renderUsers();
            updateGroupAdderSummary();
            updateUsersSelectionUI();
            showAlert('User deleted successfully!', 'success');
        } catch (error) {
            console.error('Error deleting user:', error);
            showAlert('Error deleting user: ' + error.message, 'danger');
        }
    }

    // Helper function to read file as text
    function readFileAsText(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = event => resolve(event.target.result);
            reader.onerror = error => reject(error);
            reader.readAsText(file);
        });
    }

    // Export accounts to TXT file
    function exportAccountsToTxt() {
        if (accounts.length === 0) {
            showAlert('No accounts to export', 'warning');
            return;
        }

        const lines = accounts.map(account => 
            `${account.profile_id},${account.message_file},${account.model_name}`
        ).join('\n');
        
        const dataStr = 'data:text/plain;charset=utf-8,' + encodeURIComponent(lines);
        const exportFileDefaultName = 'twitter-accounts-export.txt';
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataStr);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
        
        showAlert('Accounts exported successfully!', 'success');
    }

    // Add row to table
    function addRowToTable(account, index) {
        const tbody = document.getElementById('accountsTable');
        const row = document.createElement('tr');
        row.id = `row-${index}`;
        
        row.innerHTML = `
            <td>${account.profile_id}</td>
            <td>${account.message_file}</td>
            <td>${account.model_name}</td>
            <td class="text-center">
                <span class="badge bg-primary group-count-badge">${account.group_count || 0}</span>
            </td>
            <td>
                <button class="btn btn-sm btn-outline-warning me-1 edit-btn">
                    <i class="bi bi-pencil"></i> Edit
                </button>
                <button class="btn btn-sm btn-outline-danger delete-btn">
                    <i class="bi bi-trash"></i> Delete
                </button>
            </td>
        `;
        
        // Add event listeners
        row.querySelector('.edit-btn').addEventListener('click', () => openEditModal(index));
        row.querySelector('.delete-btn').addEventListener('click', () => deleteAccount(index));
        
        tbody.appendChild(row);
    }

    // Open edit modal
    function openEditModal(index) {
        const account = accounts[index];
        if (!account) return;
        
        document.getElementById('editIndex').value = index;
        document.getElementById('editProfileId').value = account.profile_id;
        document.getElementById('editMessageFile').value = account.message_file;
        document.getElementById('editModelName').value = account.model_name;
        
        editModal.show();
    }

    // Delete account
    async function deleteAccount(index) {
        if (!confirm('Are you sure you want to delete this account?')) {
            return;
        }
        
        try {
            const response = await fetch(apiEndpoints.deleteAccount, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    index: index
                })
            });
            
            if (!response.ok) {
                throw new Error(await response.text());
            }
            
            // Remove from local array
            accounts.splice(index, 1);
            
            // Re-render the entire table to fix indices
            renderAccountsTable();
            updateSummaryCards();
            showAlert('Account deleted successfully!', 'success');
        } catch (error) {
            console.error('Error deleting account:', error);
            showAlert('Error deleting account: ' + error.message, 'danger');
        }
    }

    // Show alert function
    function showAlert(message, type = 'info') {
        // Remove existing alerts
        const existingAlerts = document.querySelectorAll('.alert-notification');
        existingAlerts.forEach(alert => alert.remove());

        // Create new alert
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} alert-dismissible fade show alert-notification`;
        alertDiv.style.position = 'fixed';
        alertDiv.style.top = '20px';
        alertDiv.style.right = '20px';
        alertDiv.style.zIndex = '9999';
        alertDiv.style.minWidth = '300px';
        
        alertDiv.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;
        
        document.body.appendChild(alertDiv);
        
        // Auto remove after 5 seconds
        setTimeout(() => {
            alertDiv.remove();
        }, 5000);
    }

    // Update RT Bot statistics
function updateRtBotStats(data) {
    if (!data || currentModule !== 'rtBot') return;
    
    // Update general stats
    document.getElementById('cycleProgress').textContent = `${data.cycle || 0}/${data.total_cycles || 0}`;
    document.getElementById('totalDrops').textContent = data.total_drops || 0;
    document.getElementById('totalErrors').textContent = data.total_errors || 0;
    document.getElementById('runtime').textContent = data.runtime || '0:00:00.000000';
    document.getElementById('activeWorkers').textContent = data.workers || 0;
    document.getElementById('activeProfiles').textContent = Object.keys(data.profiles || {}).length || 0;
    
    // Update progress bar
    const totalCycles = data.total_cycles || 1;
    const currentCycle = data.cycle || 0;
    const progressPercent = totalCycles > 0 ? 
        Math.min(100, Math.round((currentCycle / totalCycles) * 100)) : 0;
    document.getElementById('cycleProgressBar').style.width = `${progressPercent}%`;
    
    // Update profile stats table
    renderProfileStats(data.profiles);
}

function updateProgressDashboard(data) {
    if (!data || currentModule !== 'progressDashboard') return;
    
    // Update general stats
    document.getElementById('cycleProgress').textContent = `${data.cycle || 0}/${data.total_cycles || 0}`;
    document.getElementById('totalDrops').textContent = data.total_drops || 0;
    document.getElementById('totalErrors').textContent = data.total_errors || 0;
    document.getElementById('runtime').textContent = data.runtime || '0:00:00.000000';
    document.getElementById('activeWorkers').textContent = data.workers || 0;
    
    // Update progress bar
    const totalCycles = data.total_cycles || 1;
    const currentCycle = data.cycle || 0;
    const progressPercent = totalCycles > 0 ? 
        Math.min(100, Math.round((currentCycle / totalCycles) * 100)) : 0;
    document.getElementById('cycleProgressBar').style.width = `${progressPercent}%`;
    
    // Update profile stats table
    renderProfileStats(data.profiles);
}

function renderProfileStats(profiles) {
    const tbody = document.getElementById('profileStatsTable');
    
    if (!profiles || Object.keys(profiles).length === 0) {
        if (currentModule === 'rtBot') {
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" class="text-center py-4 text-muted">
                        <i class="bi bi-pause-circle fs-1 d-block mb-2"></i>
                        <span class="fs-5">Retweet Bot is Inactive</span>
                        <p class="mt-2 mb-0">Start the bot to see performance statistics</p>
                    </td>
                </tr>
            `;
        } else {
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" class="text-center py-4">
                        <div class="empty-state">
                            <i class="bi bi-inbox"></i>
                            <h4>No profile statistics available</h4>
                            <p>Start the retweet bot to see progress data</p>
                        </div>
                    </td>
                </tr>
            `;
        }
        return;
    }
    
    tbody.innerHTML = Object.entries(profiles).map(([profileId, stats]) => `
        <tr>
            <td>${profileId}</td>
            <td>${stats.model || 'N/A'}</td>
            <td>
                <span class="badge ${stats.status === 'Working' ? 'bg-success' : 
                                  stats.status === 'Queued' ? 'bg-warning' : 
                                  stats.status === 'Error' ? 'bg-danger' : 'bg-secondary'}">
                    ${stats.status || 'Unknown'}
                </span>
            </td>
            <td>${stats.drops || 0}</td>
            <td>${stats.errors || 0}</td>
            <td>${stats.last_action || 'Never'}</td>
        </tr>
    `).join('');
}
// Periodically fetch stats when on the progress dashboard or rtBot module
// Periodically fetch stats when on the progress dashboard or rtBot module
function fetchBotStats() {
    if (currentModule === 'progressDashboard' || currentModule === 'rtBot') {
        fetch(apiEndpoints.botStats)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch bot stats');
                }
                return response.json();
            })
            .then(data => {
                updateProgressDashboard(data);
                updateRtBotStats(data);
            })
            .catch(error => {
                console.error('Error fetching bot stats:', error);
                // Don't show alert for 404 errors to avoid spam
                if (!error.message.includes('404') && !error.message.includes('405')) {
                    showAlert('Error fetching bot stats: ' + error.message, 'danger');
                }
            });
    }
}
    function stopBot(botName) {
        // Immediately update UI to show loading state
        if (botName === 'retweetbot') {
            const stopBtn = document.getElementById('stopRtBotBtn');
            const startBtn = document.getElementById('startRtBotBtn');
            
            // Save original button states
            stopBtn.setAttribute('data-original-html', stopBtn.innerHTML);
            startBtn.setAttribute('data-original-html', startBtn.innerHTML);
            
            // Show stopping state
            stopBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Stopping...';
            stopBtn.disabled = true;
            startBtn.disabled = true;
        }
        
        fetch(apiEndpoints.botStop, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `bot_name=${botName}`
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                updateModuleStatus(botName, data.running);
                updateDashboardCounts(data.modules);
                
                if (botName === 'retweetbot') {
                    // Add a small delay to show the stopping state briefly
                    setTimeout(() => {
                        updateRtBotButtonStatus(data.running);
                    }, 800); // Show "Stopping" for 0.8 seconds before updating
                }
            } else {
                showAlert(`Failed to stop ${botName}: ${data.message || 'Unknown error'}`, 'danger');
                // Reset button on error
                if (botName === 'retweetbot') {
                    setTimeout(() => {
                        updateRtBotButtonStatus(true); // Assume it's still running on error
                    }, 800);
                }
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showAlert(`Failed to stop ${botName}`, 'danger');
            // Reset button on error
            if (botName === 'retweetbot') {
                setTimeout(() => {
                    updateRtBotButtonStatus(true); // Assume it's still running on error
                }, 800);
            }
        });
    }

    // Also update the startBot function for consistency
    function startBot(botName) {
        // Immediately update UI to show loading state
        if (botName === 'retweetbot') {
            const startBtn = document.getElementById('startRtBotBtn');
            const stopBtn = document.getElementById('stopRtBotBtn');
            
            // Save original button states
            startBtn.setAttribute('data-original-html', startBtn.innerHTML);
            stopBtn.setAttribute('data-original-html', stopBtn.innerHTML);
            
            // Show starting state
            startBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Starting...';
            startBtn.disabled = true;
            stopBtn.disabled = true;
        }
        
        fetch(apiEndpoints.botStart, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `bot_name=${botName}`
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                updateModuleStatus(botName, data.running);
                updateDashboardCounts(data.modules);
                
                if (botName === 'retweetbot') {
                    // Add a small delay to show the starting state briefly
                    setTimeout(() => {
                        updateRtBotButtonStatus(data.running);
                    }, 800);
                }
            } else {
                showAlert(`Failed to start ${botName}: ${data.message || 'Unknown error'}`, 'danger');
                // Reset button on error
                if (botName === 'retweetbot') {
                    setTimeout(() => {
                        updateRtBotButtonStatus(false);
                    }, 800);
                }
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showAlert(`Failed to start ${botName}`, 'danger');
                // Reset button on error
                if (botName === 'retweetbot') {
                    setTimeout(() => {
                        updateRtBotButtonStatus(false);
                    }, 800);
                }
            });
    }

    function updateModuleStatus(botName, isRunning) {
        const moduleElement = document.getElementById(`module-${botName}`);
        if (!moduleElement) return;
        
        const statusElement = moduleElement.querySelector('.module-status');
        
        if (isRunning) {
            statusElement.textContent = 'RUNNING';
            statusElement.classList.remove('status-stopped');
            statusElement.classList.add('status-running');
        } else {
            statusElement.textContent = 'STOPPED';
            statusElement.classList.remove('status-running');
            statusElement.classList.add('status-stopped');
        }
    }

    // Load modules for dashboard
    async function loadModules() {
        try {
            const response = await fetch(apiEndpoints.botStatus);
            if (!response.ok) {
                throw new Error('Failed to load modules');
            }
            const data = await response.json();
            renderModules(data.modules);
            updateDashboardCounts(data.modules);
        } catch (error) {
            console.error('Error loading modules:', error);
            showAlert('Error loading modules: ' + error.message, 'danger');
        }
    }
    

    function renderModules(modules) {
        const container = document.getElementById('modulesGrid');
        
        if (!modules || Object.keys(modules).length === 0) {
            container.innerHTML = `
                <div class="col-12">
                    <div class="empty-state">
                        <i class="bi bi-inbox"></i>
                        <h4>No modules available</h4>
                        <p>No bot modules are currently configured</p>
                    </div>
                </div>
            `;
            return;
        }

        container.innerHTML = Object.entries(modules).map(([name, info]) => `
            <div class="module-card" id="module-${name}">
                <div class="module-header">
                    <span class="module-name">${name.charAt(0).toUpperCase() + name.slice(1)}</span>
                    <span class="module-status ${info.running ? 'status-running' : 'status-stopped'}">
                        ${info.running ? 'RUNNING' : 'STOPPED'}
                    </span>
                </div>
                <p class="module-desc">${info.help || 'No description available'}</p>
                <div class="module-actions">
                    <button class="btn btn-start" onclick="startBot('${name}')">Start</button>
                    <button class="btn btn-stop" onclick="stopBot('${name}')">Stop</button>
                </div>
            </div>
        `).join('');
    }

    function updateDashboardCounts(modules) {
        if (!modules) return;
        
        let totalModules = Object.keys(modules).length;
        let activeModules = Object.values(modules).filter(module => module.running).length;
        
        document.getElementById('totalModulesCount').textContent = totalModules;
        document.getElementById('activeModulesCount').textContent = activeModules;
    }

    // Update the checkBotStatus function to handle RT bot button state
    function checkBotStatus() {
        fetch(apiEndpoints.botStatus)
            .then(response => response.json())
            .then(data => {
                for (const [botName, info] of Object.entries(data.modules)) {
                    updateModuleStatus(botName, info.running);
                    
                    // Specifically handle RT bot button state
                    if (botName === 'retweetbot') {
                        updateRtBotButtonStatus(info.running);
                    }
                }
                updateDashboardCounts(data.modules);
            })
            .catch(error => console.error('Error checking status:', error));
    }

    // Update the updateRtBotButtonStatus function
    function updateRtBotButtonStatus(isRunning) {
        const startBtn = document.getElementById('startRtBotBtn');
        const stopBtn = document.getElementById('stopRtBotBtn');
        
        if (!startBtn || !stopBtn) return;
        
        // Reset both buttons to enabled state first
        startBtn.disabled = false;
        stopBtn.disabled = false;
        
        if (isRunning) {
            // Bot is running - show stop button as active
            startBtn.classList.remove('btn-success');
            startBtn.classList.add('btn-outline-success');
            stopBtn.classList.remove('btn-outline-danger');
            stopBtn.classList.add('btn-danger');
            
            // Update button text
            startBtn.innerHTML = '<i class="bi bi-pause-circle"></i> Running';
            stopBtn.innerHTML = '<i class="bi bi-stop-circle"></i> Stop RT Bot';
        } else {
            // Bot is stopped - show start button as active
            startBtn.classList.remove('btn-outline-success');
            startBtn.classList.add('btn-success');
            stopBtn.classList.remove('btn-danger');
            stopBtn.classList.add('btn-outline-danger');
            
            // Update button text
            startBtn.innerHTML = '<i class="bi bi-play-circle"></i> Start RT Bot';
            stopBtn.innerHTML = '<i class="bi bi-stop-circle"></i> Stopped';
        }
    }
</script>
<script>
    // Function to update bot statistics from the server
    function updateBotStats() {
        // Only update if we're on a relevant module
        if (currentModule !== 'rtBot' && currentModule !== 'progressDashboard') {
            return;
        }

        // Use fetch API to get bot statistics
        fetch('/api/twitter-bot/stats')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch bot stats');
                }
                return response.text(); // Get as text first
            })
            .then(text => {
                console.log('Raw response:', text);
                
                // Try to parse as JSON first
                try {
                    const data = JSON.parse(text);
                    console.log('Parsed as JSON:', data);
                    updateDashboard(data);
                    lastStatsUpdate = Date.now();
                    return;
                } catch (e) {
                    console.log('Not valid JSON, trying alternative parsing');
                }
                
                // If not valid JSON, try to parse the Python dictionary format
                try {
                    // Convert Python dict string to JSON
                    const jsonStr = text
                        .replace(/'/g, '"')  // Replace single quotes with double quotes
                        .replace(/None/g, 'null')  // Replace Python None with JSON null
                        .replace(/True/g, 'true')  // Replace Python True with JSON true
                        .replace(/False/g, 'false');  // Replace Python False with JSON false
                    
                    const data = JSON.parse(jsonStr);
                    console.log('Parsed Python dict:', data);
                    updateDashboard(data);
                    lastStatsUpdate = Date.now();
                } catch (e) {
                    console.error('Failed to parse response:', e);
                    showAlert('Error parsing server response', 'danger');
                }
            })
            .catch(error => {
                console.error('Error fetching bot stats:', error);
                if (!error.message.includes('404') && !error.message.includes('Failed to fetch')) {
                    showAlert('Error fetching bot stats: ' + error.message, 'danger');
                }
            });
    }

    // Function to update the dashboard with new data
    function updateDashboard(data) {
        if (!data) {
            console.log('No data received from server');
            return;
        }
        
        console.log('Updating dashboard with:', data);
        
        // Update cycle progress (with proper fallbacks)
        const cycle = data.cycle !== undefined && data.cycle !== null ? data.cycle : 0;
        const totalCycles = data.total_cycles !== undefined && data.total_cycles !== null ? data.total_cycles : 100;
        
        document.getElementById('cycleProgress').textContent = `${cycle}/${totalCycles}`;
        
        // Update progress bar
        const progressPercent = totalCycles > 0 ? 
            Math.min(100, Math.round((cycle / totalCycles) * 100)) : 0;
        document.getElementById('cycleProgressBar').style.width = `${progressPercent}%`;
        
        // Update total drops
        document.getElementById('totalDrops').textContent = data.total_drops !== undefined && data.total_drops !== null ? data.total_drops : 0;
        
        // Update total errors
        document.getElementById('totalErrors').textContent = data.total_errors !== undefined && data.total_errors !== null ? data.total_errors : 0;
        
        // Update runtime
        document.getElementById('runtime').textContent = data.runtime !== undefined && data.runtime !== null ? data.runtime : '0:00:00.000000';
        
        // Update active workers
        document.getElementById('activeWorkers').textContent = data.workers !== undefined && data.workers !== null ? data.workers : 0;
        
        // Update active profiles count
        if (data.profiles !== undefined && data.profiles !== null) {
            const activeProfiles = Object.keys(data.profiles).length;
            document.getElementById('activeProfiles').textContent = activeProfiles;
        } else {
            document.getElementById('activeProfiles').textContent = 0;
        }
        
        // Update profile statistics table
        renderProfileStats(data.profiles || {});
    }
</script>
</body>
</html>